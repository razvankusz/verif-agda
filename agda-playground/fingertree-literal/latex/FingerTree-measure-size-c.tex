\begin{code}%
\>\AgdaKeyword{module} \AgdaModule{FingerTree-measure-size-c} \AgdaKeyword{where}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Class.Reduce}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Level} \AgdaKeyword{using} \AgdaSymbol{(}\AgdaPostulate{Level}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Maybe}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Unit} \AgdaKeyword{using} \AgdaSymbol{(}\AgdaRecord{⊤}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Nat} \AgdaKeyword{using} \AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSymbol{;} \AgdaInductiveConstructor{suc}\AgdaSymbol{;} \AgdaFunction{\_<\_}\AgdaSymbol{;} \AgdaPrimitive{\_+\_}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Fin} \AgdaKeyword{using} \AgdaSymbol{(}\AgdaDatatype{Fin}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.List} \AgdaKeyword{using} \AgdaSymbol{(}\AgdaDatatype{List}\AgdaSymbol{;} \AgdaInductiveConstructor{[]}\AgdaSymbol{;} \AgdaInductiveConstructor{\_∷\_}\AgdaSymbol{;} \AgdaFunction{\_++\_}\AgdaSymbol{;} \AgdaFunction{length}\AgdaSymbol{;} \AgdaFunction{tails}\AgdaSymbol{)}\<%
\\
\>\AgdaComment{-- open import Data.List.NonEmpty using (List⁺; [\_]; \_∷\_; \_⁺++\_)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Maybe} \AgdaKeyword{using} \AgdaSymbol{(}\AgdaDatatype{Maybe}\AgdaSymbol{;} \AgdaInductiveConstructor{just}\AgdaSymbol{;} \AgdaInductiveConstructor{nothing}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Bool} \AgdaKeyword{using} \AgdaSymbol{(}\AgdaDatatype{Bool}\AgdaSymbol{;} \AgdaInductiveConstructor{true}\AgdaSymbol{;} \AgdaInductiveConstructor{false}\AgdaSymbol{;} \AgdaFunction{if\_then\_else\_}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Function} \AgdaKeyword{using}\AgdaSymbol{(}\AgdaFunction{case\_of\_}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Size}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{DependentPair}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Nullary.Negation} \AgdaKeyword{using} \AgdaSymbol{(}\AgdaFunction{contraposition}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary.PropositionalEquality}\<%
\\
\>\AgdaKeyword{open} \AgdaModule{≡-Reasoning}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Binary.HeterogeneousEquality} \AgdaKeyword{renaming} \AgdaSymbol{(}\AgdaInductiveConstructor{refl} \AgdaSymbol{to} \AgdaInductiveConstructor{hrefl}\AgdaSymbol{)} \AgdaKeyword{renaming} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{to} \AgdaFunction{hsym}\AgdaSymbol{)} \AgdaKeyword{renaming} \AgdaSymbol{(}\AgdaFunction{trans} \AgdaSymbol{to} \AgdaFunction{htrans}\AgdaSymbol{)} \AgdaKeyword{renaming} \AgdaSymbol{(}\AgdaFunction{cong} \AgdaSymbol{to} \AgdaFunction{hcong}\AgdaSymbol{)} \AgdaKeyword{renaming} \AgdaSymbol{(}\AgdaFunction{inspect} \AgdaSymbol{to} \AgdaFunction{hinspect}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaModule{≅-Reasoning} \AgdaKeyword{renaming} \AgdaSymbol{(}\AgdaFunction{begin\_} \AgdaSymbol{to} \AgdaFunction{hbegin\_}\AgdaSymbol{)} \AgdaKeyword{renaming} \AgdaSymbol{(}\AgdaFunction{\_≡⟨\_⟩\_} \AgdaSymbol{to} \AgdaFunction{\_≅⟨\_⟩\_}\AgdaSymbol{)} \AgdaKeyword{renaming} \AgdaSymbol{(} \AgdaFunction{\_∎} \AgdaSymbol{to} \AgdaFunction{\_∎\textasciitilde{}}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Data.Empty} \AgdaKeyword{using} \AgdaSymbol{(}\AgdaDatatype{⊥}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{Relation.Nullary.Negation}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{AlgebraStructures}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaModule{Measured} \AgdaSymbol{\{\{...\}\}} \AgdaKeyword{public}\<%
\\
\>\AgdaKeyword{open} \AgdaModule{Monoid} \AgdaSymbol{\{\{...\}\}} \AgdaKeyword{public}\<%
\\
%
\\
\>\AgdaComment{-- open import Relation.Binary.PropositionalEquality.TrustMe using (trustMe)}\<%
\\
%
\\
\>\AgdaComment{------------------------------------------------------------------------}\<%
\\
%
\\
\>\AgdaKeyword{data} \AgdaDatatype{Node} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{)(}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{Node2} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{v} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{y} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \<[11]%
\>[11]\AgdaSymbol{(}\AgdaBound{v} \AgdaDatatype{≡} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{y} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{Node3} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{v} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{y} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{z} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{v} \AgdaDatatype{≡} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{y} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{z} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\<%
\\
%
\\
\>\AgdaKeyword{data} \AgdaDatatype{Digit} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{):} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{One} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaBound{A} \AgdaSymbol{→} \AgdaDatatype{Digit} \AgdaBound{A}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{Two} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaDatatype{Digit} \AgdaBound{A}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{Three} \AgdaSymbol{:} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaDatatype{Digit} \AgdaBound{A}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{Four} \<[8]%
\>[8]\AgdaSymbol{:} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaDatatype{Digit} \AgdaBound{A}\<%
\\
%
\\
%
\\
\>\AgdaFunction{measure-node} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{→} \AgdaBound{V}\<%
\\
\>\AgdaFunction{measure-node} \AgdaSymbol{(}\AgdaInductiveConstructor{Node2} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{r}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x}\<%
\\
\>\AgdaFunction{measure-node} \AgdaSymbol{(}\AgdaInductiveConstructor{Node3} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃} \AgdaBound{r}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x}\<%
\\
%
\\
%
\\
\>\AgdaFunction{measure-digit} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \<[88]%
\>[88]\AgdaDatatype{Digit} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{V}\<%
\\
\>\AgdaFunction{measure-digit} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaField{Measured.∥} \AgdaBound{m} \AgdaField{∥} \AgdaBound{x}\<%
\\
\>\AgdaFunction{measure-digit} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\<%
\\
\>\AgdaFunction{measure-digit} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\<%
\\
\>\AgdaFunction{measure-digit} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\<%
\\
%
\\
\>\AgdaFunction{measure-maybe-digit} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \<[94]%
\>[94]\AgdaDatatype{Maybe} \AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{V}\<%
\\
\>\AgdaFunction{measure-maybe-digit} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{measure-digit} \AgdaBound{x}\<%
\\
\>\AgdaFunction{measure-maybe-digit} \AgdaInductiveConstructor{nothing} \AgdaSymbol{=} \AgdaField{ε}\<%
\\
%
\\
\>\AgdaKeyword{instance} \AgdaFunction{uplift} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaRecord{Measured} \AgdaSymbol{(}\AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{uplift} \<[8]%
\>[8]\AgdaSymbol{=} \AgdaInductiveConstructor{measured} \AgdaFunction{measure-node}\<%
\\
%
\\
\>\AgdaKeyword{data} \AgdaDatatype{FingerTree} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{)(}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{:}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{Empty} \<[9]%
\>[9]\AgdaSymbol{:} \<[12]%
\>[12]\AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaField{ε}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{Single} \AgdaSymbol{:} \<[12]%
\>[12]\AgdaSymbol{(}\AgdaBound{e} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaField{∥} \AgdaBound{e} \AgdaField{∥}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{Deep} \<[9]%
\>[9]\AgdaSymbol{:} \<[12]%
\>[12]\AgdaSymbol{\{}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{pr} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaSymbol{(}\AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{s}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{sf} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaFunction{measure-digit} \AgdaBound{pr} \AgdaField{∙} \AgdaBound{s} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{\}}\<%
\\
%
\\
\>\AgdaComment{----------------------------------------------------------------------------------}\<%
\\
%
\\
\>\AgdaFunction{node2} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\<%
\\
\>\AgdaFunction{node2} \AgdaBound{x} \AgdaBound{y} \AgdaSymbol{=} \AgdaInductiveConstructor{Node2} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{y} \AgdaField{∥}\AgdaSymbol{)} \AgdaBound{x} \AgdaBound{y} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaFunction{node3} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\<%
\\
\>\AgdaFunction{node3} \AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaSymbol{=} \AgdaInductiveConstructor{Node3} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{y} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{z} \AgdaField{∥}\AgdaSymbol{)} \AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaFunction{measure-tree} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{s}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaBound{V}\<%
\\
\>\AgdaFunction{measure-tree} \AgdaSymbol{\{\_\}\{\_\}\{\_\}\{}\AgdaBound{s}\AgdaSymbol{\}} \AgdaBound{ft} \AgdaSymbol{=} \AgdaBound{s}\<%
\\
%
\\
\>\AgdaFunction{measure-lemma0} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{y} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaField{∙} \AgdaField{ε} \AgdaField{∙} \AgdaBound{y}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaBound{x} \AgdaField{∙} \AgdaBound{y}\<%
\\
\>\AgdaFunction{measure-lemma0} \AgdaBound{x} \AgdaBound{y} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{x} \AgdaField{∙} \AgdaField{ε} \AgdaField{∙} \AgdaBound{y}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaField{∙-assoc} \AgdaBound{x} \AgdaField{ε} \AgdaBound{y} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaBound{x} \AgdaField{∙} \AgdaField{ε}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{y}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{z} \AgdaSymbol{→} \AgdaBound{z} \AgdaField{∙} \AgdaBound{y}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{ε-right} \AgdaBound{x}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{x} \AgdaField{∙} \AgdaBound{y}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{measure-lemma1} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{b} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{((}\AgdaBound{mo} \AgdaField{Monoid.∙} \AgdaField{Monoid.ε} \AgdaBound{mo}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{b}\AgdaSymbol{))} \AgdaDatatype{≡} \AgdaField{Measured.∥} \AgdaBound{m} \AgdaField{∥} \AgdaBound{b}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{measure-lemma1} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaBound{b} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaBound{mo} \AgdaField{Monoid.∙} \AgdaField{Monoid.ε} \AgdaBound{mo}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{b}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaField{ε-left} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{b}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{∥} \AgdaBound{b} \AgdaField{∥}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{assoc-lemma1} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{e} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{mo} \AgdaField{Monoid.∙} \AgdaField{Measured.∥} \AgdaBound{m} \AgdaField{∥} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{Measured.∥} \AgdaBound{m} \AgdaField{∥} \AgdaBound{e}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{mo} \AgdaField{Monoid.∙} \AgdaField{Measured.∥} \AgdaBound{m} \AgdaField{∥} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{((}\AgdaBound{mo} \AgdaField{Monoid.∙} \AgdaField{Monoid.ε} \AgdaBound{mo}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{Measured.∥} \AgdaBound{m} \AgdaField{∥} \AgdaBound{e}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{assoc-lemma1} \AgdaBound{a} \AgdaBound{e} \AgdaSymbol{=} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaField{∥} \AgdaBound{a} \AgdaField{∥} \AgdaField{∙} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{ε-left} \AgdaField{∥} \AgdaBound{e} \AgdaField{∥}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaFunction{assoc-lemma2} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{b} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{c} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{d} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{e} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{mo} \AgdaField{Monoid.∙} \AgdaField{Measured.∥} \AgdaBound{m} \AgdaField{∥} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{((}\AgdaBound{mo} \AgdaField{Monoid.∙} \AgdaSymbol{(}\AgdaBound{mo} \AgdaField{Monoid.∙} \AgdaField{Measured.∥} \AgdaBound{m} \AgdaField{∥} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{((}\AgdaBound{mo} \AgdaField{Monoid.∙} \AgdaField{Measured.∥} \AgdaBound{m} \AgdaField{∥} \AgdaBound{c}\AgdaSymbol{)} \AgdaSymbol{((}\AgdaBound{mo} \AgdaField{Monoid.∙} \AgdaField{Measured.∥} \AgdaBound{m} \AgdaField{∥} \AgdaBound{d}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{Measured.∥} \AgdaBound{m} \AgdaField{∥} \AgdaBound{e}\AgdaSymbol{))))} \AgdaSymbol{((}\AgdaBound{mo} \AgdaField{Monoid.∙} \AgdaBound{s}\AgdaSymbol{)} \AgdaBound{f}\AgdaSymbol{))} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{mo} \AgdaField{Monoid.∙} \AgdaSymbol{(}\AgdaBound{mo} \AgdaField{Monoid.∙} \AgdaField{Measured.∥} \AgdaBound{m} \AgdaField{∥} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{Measured.∥} \AgdaBound{m} \AgdaField{∥} \AgdaBound{b}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{((}\AgdaBound{mo} \AgdaField{Monoid.∙}\<%
\\
\>[8]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{(}\AgdaBound{mo} \AgdaField{Monoid.∙}\<%
\\
\>[9]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaBound{mo} \AgdaField{Monoid.∙} \AgdaField{Measured.∥} \AgdaBound{m} \AgdaField{∥} \AgdaBound{c}\AgdaSymbol{)}\<%
\\
\>[9]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{((}\AgdaBound{mo} \AgdaField{Monoid.∙} \AgdaField{Measured.∥} \AgdaBound{m} \AgdaField{∥} \AgdaBound{d}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{Measured.∥} \AgdaBound{m} \AgdaField{∥} \AgdaBound{e}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaBound{s}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaBound{f}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{assoc-lemma2} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c} \AgdaBound{d} \AgdaBound{e} \AgdaBound{s} \AgdaBound{f} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{∥} \AgdaBound{a} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{((}\AgdaField{∥} \AgdaBound{b} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{c} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{d} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{e} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{s} \AgdaField{∙} \AgdaBound{f}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaField{∥} \AgdaBound{a} \AgdaField{∥} \AgdaField{∙} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{b} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{c} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{d} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{e} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{s} \AgdaField{∙} \AgdaBound{f}\AgdaSymbol{)))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{∥} \AgdaBound{a} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{b} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{((} \AgdaField{∥} \AgdaBound{c} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{d} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{e} \AgdaField{∥}\AgdaSymbol{))} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{s} \AgdaField{∙} \AgdaBound{f}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{b} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{((} \AgdaField{∥} \AgdaBound{c} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{d} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{e} \AgdaField{∥}\AgdaSymbol{))} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{s} \AgdaField{∙} \AgdaBound{f}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{b} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{c} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{d} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{e} \AgdaField{∥}\AgdaSymbol{))} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{s} \AgdaField{∙} \AgdaBound{f}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{b} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{((}\AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{c} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{d} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{e} \AgdaField{∥}\AgdaSymbol{))} \AgdaBound{s} \AgdaBound{f}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaKeyword{infixr} \AgdaNumber{5} \AgdaFixityOp{\_◁\_}\<%
\\
\>\AgdaFunction{\_◁\_} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{\{}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{s}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaBound{s}\AgdaSymbol{\}}\<%
\\
\>\AgdaFunction{\_◁\_} \AgdaSymbol{\{}\AgdaBound{l}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaBound{a} \AgdaInductiveConstructor{Empty}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{rewrite} \AgdaSymbol{(}\AgdaField{Monoid.ε-right} \AgdaBound{mo}\AgdaSymbol{)} \AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{Single} \AgdaSymbol{\{}\AgdaBound{l}\AgdaSymbol{\}\{}\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaBound{a}\<%
\\
\>\AgdaFunction{\_◁\_} \AgdaSymbol{\{}\AgdaBound{l}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaSymbol{.(}\AgdaField{∥} \AgdaBound{e} \AgdaField{∥}\AgdaSymbol{)}\AgdaSymbol{\}} \AgdaBound{a} \AgdaSymbol{(}\AgdaInductiveConstructor{Single} \AgdaBound{e}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{rewrite} \AgdaFunction{assoc-lemma1} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaBound{a} \AgdaBound{e}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{a}\AgdaSymbol{)} \AgdaInductiveConstructor{Empty} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{e}\AgdaSymbol{)}\<%
\\
\>\AgdaBound{a} \AgdaFunction{◁} \AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{rewrite} \AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{b} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf}\<%
\\
\>\AgdaBound{a} \AgdaFunction{◁} \AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{b} \AgdaBound{c}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{rewrite} \AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{b} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{c} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf}\<%
\\
\>\AgdaBound{a} \AgdaFunction{◁} \AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{b} \AgdaBound{c} \AgdaBound{d}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{rewrite} \AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{b} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{c} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{d} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c} \AgdaBound{d}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf}\<%
\\
\>\AgdaBound{a} \AgdaFunction{◁} \AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{b} \AgdaBound{c} \AgdaBound{d} \AgdaBound{e}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{rewrite} \AgdaFunction{assoc-lemma2} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c} \AgdaBound{d} \AgdaBound{e} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{((}\AgdaFunction{node3} \AgdaBound{c} \AgdaBound{d} \AgdaBound{e}\AgdaSymbol{)} \AgdaFunction{◁} \AgdaBound{ft}\AgdaSymbol{)} \AgdaBound{sf}\<%
\\
%
\\
\>\AgdaKeyword{instance} \AgdaFunction{list-measure1} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaDatatype{ℕ} \AgdaSymbol{(}\AgdaDatatype{List} \AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{list-measure1} \AgdaSymbol{=} \AgdaInductiveConstructor{measured} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaInductiveConstructor{[]}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{numbers}\<%
\\
\>\AgdaKeyword{instance} \AgdaFunction{list-monoid1} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaSymbol{(}\AgdaDatatype{List} \AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{list-monoid1} \AgdaSymbol{=} \AgdaInductiveConstructor{Monoid.monoid} \AgdaInductiveConstructor{[]} \AgdaSymbol{(}\AgdaFunction{\_++\_}\AgdaSymbol{)} \AgdaFunction{[]+} \AgdaFunction{+[]} \AgdaFunction{++assoc} \AgdaSymbol{(λ} \AgdaBound{\_} \AgdaBound{\_₁} \AgdaSymbol{→} \AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{ex-ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaDatatype{ℕ} \AgdaSymbol{(}\AgdaDatatype{List} \AgdaDatatype{ℕ}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{ex-ft} \AgdaSymbol{=} \AgdaNumber{1} \AgdaFunction{◁} \AgdaNumber{2} \AgdaFunction{◁} \AgdaNumber{3} \AgdaFunction{◁} \AgdaNumber{4} \AgdaFunction{◁} \AgdaNumber{5} \AgdaFunction{◁} \AgdaNumber{6} \AgdaFunction{◁} \AgdaNumber{7} \AgdaFunction{◁} \AgdaNumber{8} \AgdaFunction{◁} \AgdaInductiveConstructor{Empty}\<%
\\
%
\\
\>\AgdaFunction{snoc-assoc-lemma1} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{m} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{n} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{q} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{((}\AgdaBound{m} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{n} \AgdaField{∙} \AgdaBound{p}\AgdaSymbol{))} \AgdaField{∙} \AgdaBound{q}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{m} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{n} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{p} \AgdaField{∙} \AgdaBound{q}\AgdaSymbol{)))}\<%
\\
\>\AgdaFunction{snoc-assoc-lemma1} \AgdaBound{m} \AgdaBound{n} \AgdaBound{p} \AgdaBound{q} \AgdaSymbol{=} \AgdaFunction{begin} \AgdaSymbol{((}\AgdaBound{m} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{n} \AgdaField{∙} \AgdaBound{p}\AgdaSymbol{))} \AgdaField{∙} \AgdaBound{q}\AgdaSymbol{)}\<%
\\
\>[11]\AgdaIndent{28}{}\<[28]%
\>[28]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x} \AgdaField{∙} \AgdaBound{q}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaBound{m} \AgdaBound{n} \AgdaBound{p}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[11]\AgdaIndent{28}{}\<[28]%
\>[28]\AgdaSymbol{((}\AgdaBound{m} \AgdaField{∙} \AgdaBound{n}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{p}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{q}\<%
\\
\>[11]\AgdaIndent{28}{}\<[28]%
\>[28]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaBound{m} \AgdaField{∙} \AgdaBound{n}\AgdaSymbol{)} \AgdaBound{p} \AgdaBound{q}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[11]\AgdaIndent{28}{}\<[28]%
\>[28]\AgdaSymbol{(}\AgdaBound{m} \AgdaField{∙} \AgdaBound{n}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{p} \AgdaField{∙} \AgdaBound{q}\AgdaSymbol{)}\<%
\\
\>[11]\AgdaIndent{28}{}\<[28]%
\>[28]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaBound{m} \AgdaBound{n} \AgdaSymbol{(}\AgdaBound{p} \AgdaField{∙} \AgdaBound{q}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[11]\AgdaIndent{28}{}\<[28]%
\>[28]\AgdaBound{m} \AgdaField{∙} \AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaBound{q} \AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{snoc-assoc-lemma2} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{m} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{n} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{q} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{r} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaBound{m} \AgdaField{∙} \AgdaBound{n} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{p} \AgdaField{∙} \AgdaBound{q}\AgdaSymbol{))} \AgdaField{∙} \AgdaBound{r} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{m} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{q} \AgdaField{∙} \AgdaBound{r}\AgdaSymbol{)))}\<%
\\
\>\AgdaFunction{snoc-assoc-lemma2} \AgdaBound{m} \AgdaBound{n} \AgdaBound{p} \AgdaBound{q} \AgdaBound{r} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaBound{m} \AgdaField{∙} \AgdaBound{n} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{p} \AgdaField{∙} \AgdaBound{q}\AgdaSymbol{))} \AgdaField{∙} \AgdaBound{r}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaBound{m} \AgdaSymbol{(}\AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaBound{q}\AgdaSymbol{)} \AgdaBound{r}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{m} \AgdaField{∙} \AgdaSymbol{((}\AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaBound{q}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{r}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{m} \AgdaField{∙} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{snoc-assoc-lemma1} \<[44]%
\>[44]\AgdaBound{n} \AgdaBound{p} \AgdaBound{q} \AgdaBound{r}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{m} \AgdaField{∙} \AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaBound{q} \AgdaField{∙} \AgdaBound{r}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{snoc-assoc-lemma3} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{m} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{n} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{q} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{r} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaBound{m} \AgdaField{∙} \AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{q} \AgdaField{∙} \AgdaBound{r}\AgdaSymbol{))} \AgdaField{∙} \AgdaBound{s} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{m} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{n} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{p} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{q} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{r} \AgdaField{∙} \AgdaBound{s}\AgdaSymbol{)))))}\<%
\\
\>\AgdaFunction{snoc-assoc-lemma3} \AgdaBound{m} \AgdaBound{n} \AgdaBound{p} \AgdaBound{q} \AgdaBound{r} \AgdaBound{s} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaBound{m} \AgdaField{∙} \AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaBound{q} \AgdaField{∙} \AgdaBound{r}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{s}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaBound{m} \AgdaSymbol{(}\AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaBound{q} \AgdaField{∙} \AgdaBound{r}\AgdaSymbol{)} \AgdaBound{s}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{m} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaBound{q} \AgdaField{∙} \AgdaBound{r}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{s}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{m} \AgdaField{∙} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{snoc-assoc-lemma2} \AgdaBound{n} \AgdaBound{p} \AgdaBound{q} \AgdaBound{r} \AgdaBound{s}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{m} \AgdaField{∙} \AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaBound{q} \AgdaField{∙} \AgdaBound{r} \AgdaField{∙} \AgdaBound{s}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{snoc-assoc-lemma4} \AgdaSymbol{:} \<[21]%
\>[21]\AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{m} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{n} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{q} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{r} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{t} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{((}\AgdaBound{m} \AgdaField{∙} \AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaBound{q} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{r} \AgdaField{∙} \AgdaBound{s}\AgdaSymbol{)))} \AgdaField{∙} \AgdaBound{t} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{m} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaBound{q} \AgdaField{∙} \AgdaBound{r}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{s} \AgdaField{∙} \AgdaBound{t}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{snoc-assoc-lemma4} \AgdaBound{m} \AgdaBound{n} \AgdaBound{p} \AgdaBound{q} \AgdaBound{r} \AgdaBound{s} \AgdaBound{t} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{((}\AgdaBound{m} \AgdaField{∙} \AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaBound{q} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{r} \AgdaField{∙} \AgdaBound{s}\AgdaSymbol{)))} \AgdaField{∙} \AgdaBound{t}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaBound{m} \AgdaSymbol{(}\AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaBound{q} \AgdaField{∙} \AgdaBound{r} \AgdaField{∙} \AgdaBound{s}\AgdaSymbol{)} \AgdaBound{t}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{m} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaBound{q} \AgdaField{∙} \AgdaBound{r} \AgdaField{∙} \AgdaBound{s}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{t}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{m} \AgdaField{∙} \AgdaBound{x} \AgdaField{∙} \AgdaBound{t}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{snoc-assoc-lemma2} \AgdaBound{n} \AgdaBound{p} \AgdaBound{q} \AgdaBound{r} \AgdaBound{s}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{m} \AgdaField{∙} \AgdaSymbol{((}\AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaBound{q} \AgdaField{∙} \AgdaBound{r}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{s}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{t}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaSymbol{(}\AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{m} \AgdaField{∙} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaBound{q} \AgdaField{∙} \AgdaBound{r}\AgdaSymbol{)} \AgdaBound{s} \AgdaBound{t}\AgdaSymbol{)))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{m} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{n} \AgdaField{∙} \AgdaBound{p} \AgdaField{∙} \AgdaBound{q} \AgdaField{∙} \AgdaBound{r}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{s} \AgdaField{∙} \AgdaBound{t}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaKeyword{infixl} \AgdaNumber{5} \AgdaFixityOp{\_▷\_}\<%
\\
\>\AgdaFunction{\_▷\_} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{\{}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{s}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{s} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{\}}\<%
\\
\>\AgdaFunction{\_▷\_} \AgdaSymbol{\{}\AgdaBound{l}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaBound{a} \AgdaInductiveConstructor{Empty} \AgdaKeyword{rewrite} \AgdaSymbol{(}\AgdaField{Monoid.ε-left} \AgdaBound{mo}\AgdaSymbol{)} \AgdaField{∥} \AgdaBound{a} \AgdaField{∥} \AgdaSymbol{=} \AgdaInductiveConstructor{Single} \AgdaSymbol{\{}\AgdaBound{l}\AgdaSymbol{\}\{}\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaBound{a}\<%
\\
\>\AgdaFunction{\_▷\_} \AgdaSymbol{\{}\AgdaBound{l}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaBound{a} \AgdaSymbol{(}\AgdaInductiveConstructor{Single} \AgdaBound{e}\AgdaSymbol{)} \AgdaKeyword{rewrite} \AgdaSymbol{(}\AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaField{∥} \AgdaBound{e} \AgdaField{∥} \AgdaField{∙} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{Monoid.ε-left} \AgdaBound{mo} \AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\AgdaSymbol{)))} \AgdaSymbol{=} \AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{e}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{Empty} \AgdaSymbol{\{}\AgdaBound{l}\AgdaSymbol{\}\{}\AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{\}\{}\AgdaBound{V}\AgdaSymbol{\})} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{a}\AgdaSymbol{)}\<%
\\
\>\AgdaBound{a} \AgdaFunction{▷} \AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{b}\AgdaSymbol{)} \AgdaKeyword{rewrite} \AgdaSymbol{(}\AgdaFunction{snoc-assoc-lemma1} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{b} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\AgdaSymbol{))} \AgdaSymbol{=} \AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{b} \AgdaBound{a}\AgdaSymbol{)}\<%
\\
\>\AgdaBound{a} \AgdaFunction{▷} \AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{c} \AgdaBound{b}\AgdaSymbol{)} \AgdaKeyword{rewrite} \AgdaSymbol{(}\AgdaFunction{snoc-assoc-lemma2} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{c} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{b} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\AgdaSymbol{))} \AgdaSymbol{=} \AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{c} \AgdaBound{b} \AgdaBound{a}\AgdaSymbol{)}\<%
\\
\>\AgdaBound{a} \AgdaFunction{▷} \AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{d} \AgdaBound{c} \AgdaBound{b} \AgdaSymbol{)} \AgdaKeyword{rewrite} \AgdaSymbol{(}\AgdaFunction{snoc-assoc-lemma3} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{d} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{c} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{b} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\AgdaSymbol{))=} \AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{d} \AgdaBound{c} \AgdaBound{b} \AgdaBound{a}\AgdaSymbol{)}\<%
\\
\>\AgdaBound{a} \AgdaFunction{▷} \AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{e} \AgdaBound{d} \AgdaBound{c} \AgdaBound{b}\AgdaSymbol{)} \AgdaKeyword{rewrite} \AgdaSymbol{(}\AgdaFunction{snoc-assoc-lemma4} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{e} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{d} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{c} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{b} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\AgdaSymbol{))=} \AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaSymbol{((}\AgdaFunction{node3} \AgdaBound{e} \AgdaBound{d} \AgdaBound{c}\AgdaSymbol{)} \AgdaFunction{▷} \AgdaBound{ft}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{b} \AgdaBound{a}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaComment{-- -- To List ----------------------------------------------------------}\<%
\\
%
\\
\>\AgdaComment{-- is an instance of the reducer but explicitly so makes proofs easier}\<%
\\
\>\AgdaFunction{toList-dig} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Digit} \AgdaBound{A} \AgdaSymbol{→} \AgdaDatatype{List} \AgdaBound{A}\<%
\\
\>\AgdaFunction{toList-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaInductiveConstructor{[]}\<%
\\
\>\AgdaFunction{toList-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaBound{x₁} \AgdaInductiveConstructor{∷} \AgdaInductiveConstructor{[]}\<%
\\
\>\AgdaFunction{toList-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaBound{x₁} \AgdaInductiveConstructor{∷} \AgdaBound{x₂} \AgdaInductiveConstructor{∷} \AgdaInductiveConstructor{[]}\<%
\\
\>\AgdaFunction{toList-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaBound{x₁} \AgdaInductiveConstructor{∷} \AgdaBound{x₂} \AgdaInductiveConstructor{∷} \AgdaBound{x₃} \AgdaInductiveConstructor{∷} \AgdaInductiveConstructor{[]}\<%
\\
%
\\
\>\AgdaFunction{toList-maybe-dig} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaDatatype{Maybe} \AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaDatatype{List} \AgdaBound{A}\<%
\\
\>\AgdaFunction{toList-maybe-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{toList-dig} \AgdaBound{x}\<%
\\
\>\AgdaFunction{toList-maybe-dig} \AgdaInductiveConstructor{nothing} \AgdaSymbol{=} \AgdaInductiveConstructor{[]}\<%
\\
%
\\
\>\AgdaFunction{toList-node} \AgdaSymbol{:} \AgdaSymbol{∀\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{List} \AgdaBound{A}\<%
\\
\>\AgdaFunction{toList-node} \AgdaSymbol{(}\AgdaInductiveConstructor{Node2} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{r} \AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x₁} \AgdaInductiveConstructor{∷} \AgdaBound{x₂} \AgdaInductiveConstructor{∷} \AgdaInductiveConstructor{[]}\<%
\\
\>\AgdaFunction{toList-node} \AgdaSymbol{(}\AgdaInductiveConstructor{Node3} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃} \AgdaBound{r}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x₁} \AgdaInductiveConstructor{∷} \AgdaBound{x₂} \AgdaInductiveConstructor{∷} \AgdaBound{x₃} \AgdaInductiveConstructor{∷} \AgdaInductiveConstructor{[]}\<%
\\
%
\\
\>\AgdaFunction{flatten-list} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}}\<%
\\
\>[6]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[6]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[6]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaDatatype{List} \AgdaSymbol{(}\AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[6]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaDatatype{List} \AgdaBound{A}\<%
\\
\>\AgdaFunction{flatten-list} \AgdaInductiveConstructor{[]} \AgdaSymbol{=} \AgdaInductiveConstructor{[]}\<%
\\
\>\AgdaFunction{flatten-list} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaBound{xs}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{toList-node} \AgdaBound{x}\AgdaSymbol{)} \AgdaFunction{++} \AgdaSymbol{(}\AgdaFunction{flatten-list} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{toList-ft} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{s}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{List} \AgdaBound{A}\<%
\\
\>\AgdaFunction{toList-ft} \AgdaInductiveConstructor{Empty} \AgdaSymbol{=} \AgdaInductiveConstructor{[]}\<%
\\
\>\AgdaFunction{toList-ft} \AgdaSymbol{(}\AgdaInductiveConstructor{Single} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaInductiveConstructor{[]}\<%
\\
\>\AgdaFunction{toList-ft} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaBound{x₁} \AgdaBound{ft} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{toList-dig} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaFunction{++}\<%
\\
\>[10]\AgdaIndent{28}{}\<[28]%
\>[28]\AgdaSymbol{(}\AgdaFunction{flatten-list} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{ft}\AgdaSymbol{))} \AgdaFunction{++}\<%
\\
\>[10]\AgdaIndent{28}{}\<[28]%
\>[28]\AgdaSymbol{(}\AgdaFunction{toList-dig} \AgdaBound{x₂}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaComment{--- View from the left ------------}\<%
\\
%
\\
\>\AgdaFunction{head-dig} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Digit} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A}\<%
\\
\>\AgdaFunction{head-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x}\<%
\\
\>\AgdaFunction{head-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x}\<%
\\
\>\AgdaFunction{head-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x}\<%
\\
\>\AgdaFunction{head-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x}\<%
\\
%
\\
\>\AgdaFunction{tails-dig} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Digit} \AgdaBound{A} \AgdaSymbol{→} \AgdaDatatype{Maybe} \AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{tails-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{nothing}\<%
\\
\>\AgdaFunction{tails-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x₁}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{tails-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{tails-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{measure-dig-lemma0} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{d} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaField{∥} \AgdaFunction{head-dig} \AgdaBound{d} \AgdaField{∥} \AgdaField{∙} \AgdaFunction{measure-maybe-digit} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{(}\AgdaFunction{tails-dig} \AgdaBound{d}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{measure-digit} \AgdaBound{d}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{measure-dig-lemma0} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaField{ε-right} \AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\<%
\\
\>\AgdaFunction{measure-dig-lemma0} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{measure-dig-lemma0} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{measure-dig-lemma0} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c} \AgdaBound{d}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaFunction{measure-digit-lemma1} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{pr} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaSymbol{(}\AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{s}\AgdaSymbol{\})} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{sf} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaSymbol{((}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{s} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))} \<[50]%
\>[50]\AgdaDatatype{≡} \AgdaSymbol{(}\AgdaField{∥} \AgdaFunction{head-dig} \AgdaBound{pr} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaSymbol{(}\AgdaFunction{tails-dig} \AgdaBound{pr}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{s} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)))}\<%
\\
\>\AgdaFunction{measure-digit-lemma1} \AgdaSymbol{\{}\AgdaArgument{s} \AgdaSymbol{=} \AgdaBound{s}\AgdaSymbol{\}} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{((}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{s} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{s} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{measure-dig-lemma0} \AgdaBound{pr}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaField{∥} \AgdaFunction{head-dig} \AgdaBound{pr} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaSymbol{(}\AgdaFunction{tails-dig} \AgdaBound{pr}\AgdaSymbol{)))} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{s} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaField{∥} \AgdaFunction{head-dig} \AgdaBound{pr} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaSymbol{(}\AgdaFunction{tails-dig} \AgdaBound{pr}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaBound{s} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaField{∥} \AgdaFunction{head-dig} \AgdaBound{pr} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaSymbol{(}\AgdaFunction{tails-dig} \AgdaBound{pr}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{s} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaComment{-- rewrite ∙-assoc (∥ head-dig pr ∥) (measure-maybe-digit (tails-dig pr)) (measure-tree ft ∙ measure-digit sf) |}\<%
\\
\>\AgdaComment{--                                             cong (λ x → x ∙ (measure-tree ft) ∙ (measure-digit sf)) (measure-dig-lemma0 ⦃ mo ⦄ ⦃ m ⦄ pr)}\<%
\\
\>\AgdaFunction{toTree-dig} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{d} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaFunction{measure-digit} \AgdaBound{d}\AgdaSymbol{\}}\<%
\\
\>\AgdaFunction{toTree-dig} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{)} \AgdaKeyword{rewrite} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{ε-right} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x} \AgdaFunction{◁} \AgdaInductiveConstructor{Empty}\<%
\\
\>\AgdaFunction{toTree-dig} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaKeyword{rewrite} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{t} \AgdaSymbol{→} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaBound{t}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{ε-right} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{))} \AgdaSymbol{=} \AgdaBound{x} \AgdaFunction{◁} \AgdaBound{x₁} \AgdaFunction{◁} \AgdaInductiveConstructor{Empty}\<%
\\
\>\AgdaFunction{toTree-dig} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaKeyword{rewrite} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{t} \AgdaSymbol{→} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaBound{t}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{ε-right} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{))} \AgdaSymbol{=} \AgdaBound{x} \AgdaFunction{◁} \AgdaBound{x₁} \AgdaFunction{◁} \AgdaBound{x₂} \AgdaFunction{◁} \AgdaInductiveConstructor{Empty}\<%
\\
\>\AgdaFunction{toTree-dig} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaKeyword{rewrite} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{t} \AgdaSymbol{→} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥} \AgdaField{∙} \AgdaBound{t}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{ε-right} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\AgdaSymbol{))=} \AgdaBound{x} \AgdaFunction{◁} \AgdaBound{x₁} \AgdaFunction{◁} \AgdaBound{x₂} \AgdaFunction{◁} \AgdaBound{x₃} \AgdaFunction{◁} \AgdaInductiveConstructor{Empty}\<%
\\
%
\\
\>\AgdaFunction{toTree-maybe-dig} \AgdaSymbol{:} \<[20]%
\>[20]\AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{d} \AgdaSymbol{:} \AgdaDatatype{Maybe} \AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaFunction{measure-maybe-digit} \AgdaBound{d}\AgdaSymbol{\}}\<%
\\
\>\AgdaFunction{toTree-maybe-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{toTree-dig} \AgdaBound{x}\<%
\\
\>\AgdaFunction{toTree-maybe-dig} \AgdaInductiveConstructor{nothing} \AgdaSymbol{=} \AgdaInductiveConstructor{Empty}\<%
\\
%
\\
\>\AgdaFunction{measure-to-tree-maybe-dig-lemma} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{d} \AgdaSymbol{:} \AgdaDatatype{Maybe} \AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{(}\AgdaFunction{toTree-maybe-dig} \AgdaBound{d}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{measure-maybe-digit} \AgdaBound{d}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{measure-to-tree-maybe-dig-lemma} \AgdaBound{d} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaComment{-- view from the left ... ----------------------------------------------------------------------------}\<%
\\
%
\\
\>\AgdaKeyword{data} \AgdaDatatype{ViewL} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{)(}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{)}\<%
\\
\>[8]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[8]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{:}\<%
\\
\>[8]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{NilL} \AgdaSymbol{:} \<[10]%
\>[10]\AgdaDatatype{ViewL} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaField{ε}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{ConsL} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{xs} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\})}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{ViewL} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaBound{z}\AgdaSymbol{\}}\<%
\\
%
\\
\>\AgdaFunction{assoc-lemma3} \AgdaSymbol{:} \AgdaSymbol{∀} \<[18]%
\>[18]\AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[10]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x₁} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x₂} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{z} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{sf} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[10]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaField{ε} \AgdaField{∙} \AgdaSymbol{(((}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{z}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{z} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{assoc-lemma3} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{v} \AgdaBound{sf} \AgdaSymbol{=} \AgdaFunction{begin}\<%
\\
\>[14]\AgdaIndent{30}{}\<[30]%
\>[30]\AgdaField{ε} \AgdaField{∙} \AgdaSymbol{(((}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{v}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{26}{}\<[26]%
\>[26]\AgdaFunction{≡⟨} \AgdaField{ε-left} \AgdaSymbol{(((}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{v}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[26]\AgdaIndent{30}{}\<[30]%
\>[30]\AgdaSymbol{((}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{v}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{26}{}\<[26]%
\>[26]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)} \AgdaBound{v} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[26]\AgdaIndent{30}{}\<[30]%
\>[30]\AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{v} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{26}{}\<[26]%
\>[26]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{assoc-lemma4} \AgdaSymbol{:} \AgdaSymbol{∀} \<[18]%
\>[18]\AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x₁} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x₂} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x₃} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{z} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{sf} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{ε} \AgdaField{∙} \AgdaSymbol{(((}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{z}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥} \AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{z} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{assoc-lemma4} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃} \AgdaBound{v} \AgdaBound{sf} \AgdaSymbol{=} \AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{30}{}\<[30]%
\>[30]\AgdaField{ε} \AgdaField{∙} \AgdaSymbol{(((}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{v}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{26}{}\<[26]%
\>[26]\AgdaFunction{≡⟨} \AgdaField{ε-left} \AgdaSymbol{(((}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{v}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[26]\AgdaIndent{30}{}\<[30]%
\>[30]\AgdaSymbol{((}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{v}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{26}{}\<[26]%
\>[26]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\AgdaSymbol{)} \AgdaBound{v} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[26]\AgdaIndent{30}{}\<[30]%
\>[30]\AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{v} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{26}{}\<[26]%
\>[26]\AgdaFunction{∎}\<%
\\
%
\\
%
\\
\>\AgdaKeyword{mutual}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{viewL} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{ViewL} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{viewL} \AgdaInductiveConstructor{Empty} \AgdaSymbol{=} \AgdaInductiveConstructor{NilL}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{viewL} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaSymbol{(}\AgdaInductiveConstructor{Single} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{rewrite} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{Monoid.ε-right} \AgdaBound{mo} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{=} \AgdaInductiveConstructor{ConsL} \AgdaBound{x} \AgdaInductiveConstructor{Empty}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{viewL} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{rewrite} \AgdaFunction{measure-digit-lemma1} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{=} \AgdaInductiveConstructor{ConsL} \AgdaSymbol{(}\AgdaFunction{head-dig} \AgdaBound{pr}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{deepL} \AgdaSymbol{(}\AgdaFunction{tails-dig} \AgdaBound{pr}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{deepL} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{\{}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{pr} \AgdaSymbol{:} \AgdaDatatype{Maybe} \AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{))}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaSymbol{(}\AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{s}\AgdaSymbol{\})}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{sf} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaFunction{measure-maybe-digit} \AgdaBound{pr} \AgdaField{∙} \AgdaBound{s} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- deepL pr ft sf = \{!   !\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{deepL} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf} \AgdaSymbol{=} \AgdaInductiveConstructor{Deep} \AgdaBound{x} \AgdaBound{ft} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{deepL} \AgdaInductiveConstructor{nothing} \AgdaBound{ft} \AgdaBound{sf} \AgdaKeyword{with} \AgdaFunction{viewL} \AgdaBound{ft}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{deepL} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaInductiveConstructor{nothing} \AgdaBound{ft} \AgdaBound{sf} \AgdaSymbol{|} \AgdaInductiveConstructor{NilL}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{rewrite} \AgdaSymbol{(}\AgdaField{Monoid.ε-left} \AgdaBound{mo}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{ε} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{|} \AgdaSymbol{(}\AgdaField{Monoid.ε-left} \AgdaBound{mo}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{=} \AgdaFunction{toTree-dig} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{deepL} \AgdaInductiveConstructor{nothing} \AgdaBound{ft} \AgdaBound{sf} \AgdaSymbol{|} \AgdaInductiveConstructor{ConsL} \AgdaSymbol{(}\AgdaInductiveConstructor{Node2} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{r}\AgdaSymbol{)} \AgdaBound{x₃}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{rewrite} \AgdaBound{r}\<%
\\
\>[4]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{|} \AgdaFunction{assoc-lemma3} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{=} \AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaBound{x₃} \AgdaBound{sf} \AgdaComment{-- Deep (Two x₁ x₂) x₃ sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{deepL} \AgdaInductiveConstructor{nothing} \AgdaBound{ft} \AgdaBound{sf} \AgdaSymbol{|} \AgdaInductiveConstructor{ConsL} \AgdaSymbol{(}\AgdaInductiveConstructor{Node3} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃} \AgdaBound{r}\AgdaSymbol{)} \AgdaBound{x₄}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{rewrite} \AgdaBound{r}\<%
\\
\>[4]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{|} \AgdaFunction{assoc-lemma4} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{x₄}\AgdaSymbol{)} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{=} \AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaBound{x₄} \AgdaBound{sf} \AgdaComment{-- Deep (Three x₁ x₂ x₃) x₄ sf}\<%
\\
%
\\
\>\AgdaFunction{headL} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[4]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{(}\AgdaBound{i} \AgdaFunction{≢} \AgdaField{ε}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\})} \AgdaSymbol{→} \AgdaBound{A}\<%
\\
\>\AgdaFunction{headL} \AgdaBound{nempty} \AgdaInductiveConstructor{Empty} \AgdaKeyword{with} \AgdaBound{nempty} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{headL} \AgdaBound{nempty} \AgdaInductiveConstructor{Empty} \AgdaSymbol{|} \AgdaSymbol{()}\<%
\\
\>\AgdaFunction{headL} \AgdaBound{nempty} \AgdaSymbol{(}\AgdaInductiveConstructor{Single} \AgdaBound{e}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{e}\<%
\\
\>\AgdaFunction{headL} \AgdaBound{nempty} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x}\<%
\\
\>\AgdaFunction{headL} \AgdaBound{nempty} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x}\<%
\\
\>\AgdaFunction{headL} \AgdaBound{nempty} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x}\<%
\\
\>\AgdaFunction{headL} \AgdaBound{nempty} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x}\<%
\\
%
\\
\>\AgdaComment{-- the result is a dependent pair that holds both the size and the tree.}\<%
\\
\>\AgdaComment{-- this way I can change the return type based on the construction of ft without}\<%
\\
\>\AgdaComment{-- making further assumptions about i}\<%
\\
%
\\
\>\AgdaComment{-- the first attempt is to return the result of deepL, see if that yields any result.}\<%
\\
\>\AgdaComment{-- note that deepL is itself using the construct we are trying to avoid, so it might}\<%
\\
\>\AgdaComment{-- not work :()}\<%
\\
\>\AgdaFunction{tailL} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{9}{}\<[9]%
\>[9]\AgdaSymbol{(}\AgdaBound{i} \AgdaFunction{≢} \AgdaField{ε}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\})} \AgdaSymbol{→} \AgdaRecord{Σ} \AgdaBound{V} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{x}\AgdaSymbol{\})}\<%
\\
\>\AgdaFunction{tailL} \AgdaBound{nempty} \AgdaInductiveConstructor{Empty} \AgdaKeyword{with} \AgdaBound{nempty} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{tailL} \AgdaBound{nempty} \AgdaInductiveConstructor{Empty} \AgdaSymbol{|} \AgdaSymbol{()}\<%
\\
\>\AgdaFunction{tailL} \AgdaBound{nempty} \AgdaSymbol{(}\AgdaInductiveConstructor{Single} \AgdaBound{e}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{⟨} \AgdaField{ε} \AgdaInductiveConstructor{,} \AgdaInductiveConstructor{Empty} \AgdaInductiveConstructor{⟩}\<%
\\
\>\AgdaFunction{tailL} \AgdaBound{nempty} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{⟨} \AgdaSymbol{((}\AgdaFunction{measure-maybe-digit} \AgdaSymbol{(}\AgdaFunction{tails-dig} \AgdaBound{pr}\AgdaSymbol{))} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))} \AgdaInductiveConstructor{,} \AgdaFunction{deepL} \AgdaSymbol{(}\AgdaFunction{tails-dig} \AgdaBound{pr}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf} \AgdaInductiveConstructor{⟩}\<%
\\
%
\\
\>\AgdaComment{-- view from the right...--------------------------------------------------------------------------------------------------}\<%
\\
%
\\
%
\\
\>\AgdaFunction{heads-dig} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Digit} \AgdaBound{A} \AgdaSymbol{→} \AgdaDatatype{Maybe} \AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{heads-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{nothing}\<%
\\
\>\AgdaFunction{heads-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{heads-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{heads-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{tail-dig} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{Digit} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A}\<%
\\
\>\AgdaFunction{tail-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x}\<%
\\
\>\AgdaFunction{tail-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x₁}\<%
\\
\>\AgdaFunction{tail-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x₂}\<%
\\
\>\AgdaFunction{tail-dig} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x₃}\<%
\\
%
\\
\>\AgdaFunction{measure-digit-lemma2} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{d} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{((}\AgdaFunction{measure-maybe-digit} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaSymbol{(}\AgdaFunction{heads-dig} \AgdaBound{d}\AgdaSymbol{))} \AgdaField{∙} \AgdaField{∥} \AgdaFunction{tail-dig} \AgdaBound{d} \AgdaField{∥}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{measure-digit} \AgdaBound{d}\<%
\\
\>\AgdaFunction{measure-digit-lemma2} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaField{ε-left} \AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\<%
\\
\>\AgdaFunction{measure-digit-lemma2} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{measure-digit-lemma2} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c} \AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{b} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{c} \AgdaField{∥}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{measure-digit-lemma2} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c} \AgdaBound{d}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{snoc-assoc-lemma1} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{b} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{c} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{d} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{viewr-deep-measure-lemma} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{vpr} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{vft} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{sf} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(}\AgdaBound{vpr} \AgdaField{∙} \AgdaBound{vft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{vpr} \AgdaField{∙} \AgdaBound{vft} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaSymbol{(}\AgdaFunction{heads-dig} \AgdaBound{sf}\AgdaSymbol{)))} \AgdaField{∙} \AgdaField{∥} \AgdaFunction{tail-dig} \AgdaBound{sf} \AgdaField{∥}\<%
\\
\>\AgdaFunction{viewr-deep-measure-lemma} \AgdaBound{vpr} \AgdaBound{vft} \AgdaBound{sf} \AgdaSymbol{=} \AgdaFunction{begin} \AgdaSymbol{(}\AgdaBound{vpr} \AgdaField{∙} \AgdaBound{vft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{38}{}\<[38]%
\>[38]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{vpr} \AgdaField{∙} \AgdaBound{vft} \AgdaField{∙} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{measure-digit-lemma2} \AgdaBound{sf}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{38}{}\<[38]%
\>[38]\AgdaBound{vpr} \AgdaField{∙} \AgdaBound{vft} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaSymbol{(}\AgdaFunction{heads-dig} \AgdaBound{sf}\AgdaSymbol{))} \AgdaField{∙} \AgdaField{∥} \AgdaFunction{tail-dig} \AgdaBound{sf} \AgdaField{∥}\<%
\\
\>[2]\AgdaIndent{38}{}\<[38]%
\>[38]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{snoc-assoc-lemma1} \AgdaBound{vpr} \AgdaBound{vft} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaSymbol{(}\AgdaFunction{heads-dig} \AgdaBound{sf}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaField{∥} \AgdaFunction{tail-dig} \AgdaBound{sf} \AgdaField{∥}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{38}{}\<[38]%
\>[38]\AgdaSymbol{(}\AgdaBound{vpr} \AgdaField{∙} \AgdaBound{vft} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaSymbol{(}\AgdaFunction{heads-dig} \AgdaBound{sf}\AgdaSymbol{)))} \AgdaField{∙} \AgdaField{∥} \AgdaFunction{tail-dig} \AgdaBound{sf} \AgdaField{∥} \AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{deepr-measure-lemma1} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{pr} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{z} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ma} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{mb} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{μ} \AgdaDatatype{≡} \AgdaBound{ma} \AgdaField{∙} \AgdaBound{mb}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaBound{pr} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{z} \AgdaField{∙} \AgdaBound{μ}\AgdaSymbol{)} \AgdaField{∙} \AgdaField{ε} \<[32]%
\>[32]\AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{pr} \AgdaField{∙} \AgdaBound{z} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{ma} \AgdaField{∙} \AgdaBound{mb}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{deepr-measure-lemma1} \AgdaBound{pr} \AgdaBound{z} \AgdaSymbol{\_} \AgdaBound{ma} \AgdaBound{mb} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaFunction{begin} \AgdaSymbol{(}\AgdaBound{pr} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{z} \AgdaField{∙} \AgdaBound{ma} \AgdaField{∙} \AgdaBound{mb}\AgdaSymbol{)} \AgdaField{∙} \AgdaField{ε}\AgdaSymbol{)}\<%
\\
\>[14]\AgdaIndent{40}{}\<[40]%
\>[40]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{pr} \AgdaField{∙} \AgdaBound{x} \AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{ε-right} \AgdaSymbol{(}\AgdaBound{z} \AgdaField{∙} \AgdaBound{ma} \AgdaField{∙} \AgdaBound{mb}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[14]\AgdaIndent{40}{}\<[40]%
\>[40]\AgdaSymbol{(}\AgdaBound{pr} \AgdaField{∙} \AgdaBound{z} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{ma} \AgdaField{∙} \AgdaBound{mb}\AgdaSymbol{))} \AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{deepr-measure-lemma2} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{pr} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{z} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ma} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{mb} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{mc} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{μ} \AgdaDatatype{≡} \AgdaBound{ma} \AgdaField{∙} \AgdaBound{mb} \AgdaField{∙} \AgdaBound{mc}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaBound{pr} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{z} \AgdaField{∙} \AgdaBound{μ}\AgdaSymbol{)} \AgdaField{∙} \AgdaField{ε} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{pr} \AgdaField{∙} \AgdaBound{z} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{ma} \AgdaField{∙} \AgdaBound{mb} \AgdaField{∙} \AgdaBound{mc}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{deepr-measure-lemma2} \AgdaBound{pr} \AgdaBound{z} \AgdaSymbol{\_} \AgdaBound{ma} \AgdaBound{mb} \AgdaBound{mc} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaFunction{begin} \AgdaSymbol{(}\AgdaBound{pr} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{z} \AgdaField{∙} \AgdaBound{ma} \AgdaField{∙} \AgdaBound{mb} \AgdaField{∙} \AgdaBound{mc}\AgdaSymbol{)} \AgdaField{∙} \AgdaField{ε}\AgdaSymbol{)}\<%
\\
\>[14]\AgdaIndent{40}{}\<[40]%
\>[40]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{pr} \AgdaField{∙} \AgdaBound{x} \AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{ε-right} \AgdaSymbol{(}\AgdaBound{z} \AgdaField{∙} \AgdaBound{ma} \AgdaField{∙} \AgdaBound{mb} \AgdaField{∙} \AgdaBound{mc} \AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[14]\AgdaIndent{40}{}\<[40]%
\>[40]\AgdaSymbol{(}\AgdaBound{pr} \AgdaField{∙} \AgdaBound{z} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{ma} \AgdaField{∙} \AgdaBound{mb} \AgdaField{∙} \AgdaBound{mc}\AgdaSymbol{))} \AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaKeyword{data} \AgdaDatatype{ViewR} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}(}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{)(}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{:} \AgdaSymbol{\{}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{NilR} \AgdaSymbol{:} \AgdaDatatype{ViewR} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaField{ε}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{ConsR} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{z} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{xs} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{z}\AgdaSymbol{\})} \AgdaSymbol{→} \AgdaDatatype{ViewR} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{z} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{\}}\<%
\\
%
\\
\>\AgdaKeyword{mutual}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{viewR} \AgdaSymbol{:} \<[11]%
\>[11]\AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{ViewR} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{i}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{viewR} \AgdaInductiveConstructor{Empty} \AgdaSymbol{=} \AgdaInductiveConstructor{NilR}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{viewR} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{(}\AgdaInductiveConstructor{Single} \AgdaBound{x}\AgdaSymbol{)} \AgdaKeyword{rewrite} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{Monoid.ε-left} \AgdaBound{mo} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{ConsR} \AgdaBound{x} \AgdaInductiveConstructor{Empty}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{viewR} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)} \AgdaKeyword{rewrite} \AgdaFunction{viewr-deep-measure-lemma} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{)} \AgdaBound{sf} \AgdaSymbol{=} \AgdaInductiveConstructor{ConsR} \AgdaSymbol{(}\AgdaFunction{tail-dig} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{deepR} \AgdaBound{pr} \AgdaBound{ft} \AgdaSymbol{(}\AgdaFunction{heads-dig} \AgdaBound{sf}\AgdaSymbol{))}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{deepR} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaBound{pr} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaSymbol{(}\AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{s}\AgdaSymbol{\})} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{sf} \AgdaSymbol{:} \AgdaDatatype{Maybe} \AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaFunction{measure-digit} \AgdaBound{pr} \AgdaField{∙} \AgdaBound{s} \AgdaField{∙} \AgdaFunction{measure-maybe-digit} \AgdaBound{sf}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{deepR} \AgdaBound{pr} \AgdaBound{ft} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{deepR} \AgdaBound{pr} \AgdaBound{ft} \AgdaInductiveConstructor{nothing} \AgdaKeyword{with} \AgdaFunction{viewR} \AgdaBound{ft}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{deepR} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaBound{pr} \AgdaBound{ft} \AgdaInductiveConstructor{nothing} \AgdaSymbol{|} \AgdaInductiveConstructor{NilR} \AgdaKeyword{rewrite} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaBound{pr}\AgdaSymbol{)} \AgdaField{ε} \AgdaField{ε}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{48}{}\<[48]%
\>[48]\AgdaSymbol{|} \AgdaSymbol{(}\AgdaField{Monoid.ε-right} \AgdaBound{mo}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{pr} \AgdaField{∙} \AgdaField{ε}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{48}{}\<[48]%
\>[48]\AgdaSymbol{|} \AgdaSymbol{(}\AgdaField{Monoid.ε-right} \AgdaBound{mo}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{toTree-dig} \AgdaBound{pr}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{deepR} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaBound{pr} \AgdaBound{ft} \AgdaInductiveConstructor{nothing} \AgdaSymbol{|} \AgdaInductiveConstructor{ConsR} \AgdaSymbol{(}\AgdaInductiveConstructor{Node2} \AgdaBound{μ} \AgdaBound{a} \AgdaBound{b} \AgdaBound{r}\AgdaSymbol{)} \AgdaBound{xs} \AgdaKeyword{rewrite} \AgdaFunction{deepr-measure-lemma1} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{xs}\AgdaSymbol{)} \AgdaBound{μ} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{b} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{60}{}\<[60]%
\>[60]\AgdaBound{r} \AgdaSymbol{=} \AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{xs} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{deepR} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaBound{pr} \AgdaBound{ft} \AgdaInductiveConstructor{nothing} \AgdaSymbol{|} \AgdaInductiveConstructor{ConsR} \AgdaSymbol{(}\AgdaInductiveConstructor{Node3} \AgdaBound{μ} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c} \AgdaBound{r}\AgdaSymbol{)} \AgdaBound{xs} \AgdaKeyword{rewrite} \AgdaFunction{deepr-measure-lemma2} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{xs}\AgdaSymbol{)} \AgdaBound{μ} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{b} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{c} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{60}{}\<[60]%
\>[60]\AgdaBound{r} \AgdaSymbol{=} \AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{xs} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaComment{-- Split - brace : this will be a nightmare ----------------}\<%
\\
%
\\
\>\AgdaComment{-- first, the non-dependent split for digits -- copied from the first version}\<%
\\
%
\\
\>\AgdaKeyword{data} \AgdaDatatype{Split} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{F} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{split} \AgdaSymbol{:} \AgdaBound{F} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{F} \AgdaSymbol{→} \AgdaDatatype{Split} \AgdaBound{F} \AgdaBound{A}\<%
\\
%
\\
%
\\
\>\AgdaFunction{toDigit} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Digit} \AgdaBound{A}\<%
\\
\>\AgdaFunction{toDigit} \AgdaSymbol{(}\AgdaInductiveConstructor{Node2} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{r}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{Two} \AgdaBound{x₁} \AgdaBound{x₂}\<%
\\
\>\AgdaFunction{toDigit} \AgdaSymbol{(}\AgdaInductiveConstructor{Node3} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃} \AgdaBound{r}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{Three} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\<%
\\
%
\\
%
\\
\>\AgdaFunction{splitDigit} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Bool}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaBound{V}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{Digit} \AgdaBound{A}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{Split} \AgdaSymbol{(}\AgdaDatatype{Maybe} \AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{))} \AgdaBound{A}\<%
\\
\>\AgdaFunction{splitDigit} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{split} \AgdaInductiveConstructor{nothing} \AgdaBound{x} \AgdaInductiveConstructor{nothing}\<%
\\
\>\AgdaFunction{splitDigit} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{if} \AgdaSymbol{(}\AgdaBound{p} \AgdaBound{i}\AgdaSymbol{)} \AgdaFunction{then}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaInductiveConstructor{split} \AgdaInductiveConstructor{nothing} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x₁}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{else} \AgdaFunction{if} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{))} \AgdaFunction{then}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaInductiveConstructor{split} \AgdaInductiveConstructor{nothing} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x₁}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{else}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaInductiveConstructor{split} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{))} \AgdaBound{x₁} \AgdaInductiveConstructor{nothing}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{splitDigit} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{if} \AgdaSymbol{(}\AgdaBound{p} \AgdaBound{i}\AgdaSymbol{)} \AgdaFunction{then}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaInductiveConstructor{split} \AgdaInductiveConstructor{nothing} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{else} \AgdaFunction{if} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{))} \AgdaFunction{then}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaInductiveConstructor{split} \AgdaInductiveConstructor{nothing} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{else} \AgdaFunction{if} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{)} \AgdaFunction{then}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{split} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{))} \AgdaBound{x₁} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x₂}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{else}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{split} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{))} \AgdaBound{x₂} \AgdaInductiveConstructor{nothing}\<%
\\
\>\AgdaFunction{splitDigit} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{if} \AgdaSymbol{(}\AgdaBound{p} \AgdaBound{i}\AgdaSymbol{)} \AgdaFunction{then}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaInductiveConstructor{split} \AgdaInductiveConstructor{nothing} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{else} \AgdaFunction{if} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{))} \AgdaFunction{then}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaInductiveConstructor{split} \AgdaInductiveConstructor{nothing} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{else} \AgdaFunction{if} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{))} \AgdaFunction{then}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{split} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{))} \AgdaBound{x₁} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{else} \AgdaFunction{if} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{))} \AgdaFunction{then}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{split} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{))} \AgdaBound{x₂} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x₃}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{else}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaInductiveConstructor{split} \AgdaSymbol{(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{))} \AgdaBound{x₃} \AgdaInductiveConstructor{nothing}\<%
\\
%
\\
\>\AgdaComment{-- measuring function for the digit split result}\<%
\\
%
\\
\>\AgdaFunction{measure-split-digit} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→}\<%
\\
\>[4]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaDatatype{Split} \AgdaSymbol{(}\AgdaDatatype{Maybe} \AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{))} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{V}\<%
\\
\>\AgdaFunction{measure-split-digit} \AgdaSymbol{(}\AgdaInductiveConstructor{split} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{measure-maybe-digit} \AgdaBound{l} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{r}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaComment{-- proving that during the digit split the size is conserved}\<%
\\
%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaComment{-- predicate and initial value}\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{d} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \<[31]%
\>[31]\AgdaComment{-- argument}\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{l} \AgdaSymbol{:} \AgdaDatatype{Maybe} \AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{r} \AgdaSymbol{:} \AgdaDatatype{Maybe}\AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaComment{-- flattened split}\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaFunction{splitDigit} \AgdaBound{p} \AgdaBound{i} \AgdaBound{d} \AgdaDatatype{≡} \AgdaInductiveConstructor{split} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r}\AgdaSymbol{)} \AgdaSymbol{→} \<[50]%
\>[50]\AgdaComment{-- proof on the split}\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaBound{l} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{r}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{measure-digit} \AgdaBound{d}\AgdaSymbol{)} \AgdaComment{-- statement}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{.}\AgdaInductiveConstructor{nothing} \AgdaSymbol{.}\AgdaBound{x} \AgdaSymbol{.}\AgdaInductiveConstructor{nothing} \AgdaInductiveConstructor{refl} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{ε} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{ε}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaField{ε-left} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{ε}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{ε}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaField{ε-right} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaBound{l} \AgdaBound{x₂} \AgdaBound{r} \AgdaBound{prf} \AgdaKeyword{with} \AgdaBound{p} \AgdaBound{i}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaBound{l} \AgdaBound{x₂} \AgdaBound{r} \AgdaBound{prf} \<[51]%
\>[51]\AgdaSymbol{|} \AgdaInductiveConstructor{false}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{.(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{))} \AgdaSymbol{.}\AgdaBound{x₁} \AgdaSymbol{.}\AgdaInductiveConstructor{nothing} \AgdaInductiveConstructor{refl} \AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{ε}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{ε} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaField{ε}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaField{ε-right} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{.}\AgdaInductiveConstructor{nothing} \AgdaSymbol{.}\AgdaBound{x} \AgdaSymbol{.(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x₁}\AgdaSymbol{))} \AgdaInductiveConstructor{refl} \AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{|} \AgdaInductiveConstructor{true} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{ε-left} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{.}\AgdaInductiveConstructor{nothing} \AgdaSymbol{.}\AgdaBound{x} \AgdaSymbol{.(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x₁}\AgdaSymbol{))} \AgdaInductiveConstructor{refl} \AgdaSymbol{|} \AgdaInductiveConstructor{true} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{ε-left} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaBound{l} \AgdaBound{x₃} \AgdaBound{r} \AgdaBound{prf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{|} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{.(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{))} \AgdaSymbol{.}\AgdaBound{x₂} \AgdaSymbol{.}\AgdaInductiveConstructor{nothing} \AgdaInductiveConstructor{refl}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥} \AgdaField{∙} \AgdaField{ε}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{a} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{ε-right} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{.(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{))} \AgdaSymbol{.}\AgdaBound{x₁} \AgdaSymbol{.(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x₂}\AgdaSymbol{))} \AgdaInductiveConstructor{refl}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{|} \AgdaInductiveConstructor{true} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{.}\AgdaInductiveConstructor{nothing} \AgdaSymbol{.}\AgdaBound{x} \AgdaSymbol{.(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{))} \AgdaInductiveConstructor{refl}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{|} \AgdaInductiveConstructor{true} \AgdaSymbol{|} \AgdaBound{v3} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{ε-left} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{.}\AgdaInductiveConstructor{nothing} \AgdaSymbol{.}\AgdaBound{x} \AgdaSymbol{.(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{))} \AgdaInductiveConstructor{refl}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{true} \AgdaSymbol{|} \AgdaBound{v2} \AgdaSymbol{|} \AgdaBound{v3} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{ε-left} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaBound{l} \AgdaBound{x₄} \AgdaBound{r} \AgdaBound{prf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{with} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{|} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{.(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{))} \AgdaSymbol{.}\AgdaBound{x₃} \AgdaSymbol{.}\AgdaInductiveConstructor{nothing} \AgdaInductiveConstructor{refl}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥} \AgdaField{∙} \AgdaField{ε}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{a} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{ε-right} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{≡⟨} \AgdaFunction{snoc-assoc-lemma1} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∎}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{.(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{))} \AgdaSymbol{.}\AgdaBound{x₂} \AgdaSymbol{.(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x₃}\AgdaSymbol{))} \AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{|} \AgdaInductiveConstructor{true} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[3]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaFunction{∎}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{.(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{))} \AgdaSymbol{.}\AgdaBound{x₁} \AgdaSymbol{.(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{))} \AgdaInductiveConstructor{refl}\<%
\\
\>[3]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{|} \AgdaInductiveConstructor{true} \AgdaSymbol{|} \AgdaBound{v4} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{.}\AgdaInductiveConstructor{nothing} \AgdaSymbol{.}\AgdaBound{x} \AgdaSymbol{.(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{))} \AgdaInductiveConstructor{refl}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{false} \AgdaSymbol{|} \AgdaInductiveConstructor{true} \AgdaSymbol{|} \AgdaBound{v3} \AgdaSymbol{|} \AgdaBound{v4} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{ε-left} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{.}\AgdaInductiveConstructor{nothing} \AgdaSymbol{.}\AgdaBound{x} \AgdaSymbol{.(}\AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{))} \AgdaInductiveConstructor{refl}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{true} \AgdaSymbol{|} \AgdaBound{v2} \AgdaSymbol{|} \AgdaBound{v3} \AgdaSymbol{|} \AgdaBound{v4} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaField{ε-left} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaComment{-- now, defining a dependently typed split.}\<%
\\
%
\\
\>\AgdaKeyword{data} \AgdaDatatype{Split-d} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{(}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{:}\<%
\\
\>[2]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaInductiveConstructor{split-d} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{μ₁} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{μ₂} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ₁}\AgdaSymbol{\})} \<[35]%
\>[35]\AgdaComment{-- left side}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \<[35]%
\>[35]\AgdaComment{-- middle}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ₂}\AgdaSymbol{\})} \<[35]%
\>[35]\AgdaComment{-- right side}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{Split-d} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ₁} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaBound{μ₂}\AgdaSymbol{\}}\<%
\\
%
\\
\>\AgdaComment{-- the journey of a thousand miles begins with one step}\<%
\\
%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{-- split-assoc-lemma0 :}\<%
\\
%
\\
\>\AgdaFunction{split-Tree1-measure-lemma} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[10]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaComment{-- predicate and initial value}\<%
\\
\>[10]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{pr} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaSymbol{(}\AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\})} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{sf} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \<[86]%
\>[86]\AgdaComment{-- flattened deep constructor}\<%
\\
\>[10]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{l} \AgdaSymbol{:} \AgdaDatatype{Maybe} \AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{r} \AgdaSymbol{:} \AgdaDatatype{Maybe}\AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaComment{-- flattened split}\<%
\\
\>[10]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaFunction{splitDigit} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaDatatype{≡} \AgdaInductiveConstructor{split} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r}\AgdaSymbol{)} \AgdaSymbol{→} \<[51]%
\>[51]\AgdaComment{-- proof on the split}\<%
\\
\>[10]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaBound{pr} \AgdaField{∙} \AgdaBound{μ} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf} \AgdaDatatype{≡} \AgdaFunction{measure-tree} \AgdaSymbol{(}\AgdaFunction{toTree-maybe-dig} \AgdaBound{l}\AgdaSymbol{)} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{r} \AgdaField{∙} \AgdaBound{μ} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{split-Tree1-measure-lemma} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r} \AgdaBound{eq} \AgdaSymbol{=} \AgdaFunction{begin} \AgdaFunction{measure-digit} \AgdaBound{pr} \AgdaField{∙} \AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\<%
\\
\>[14]\AgdaIndent{48}{}\<[48]%
\>[48]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{t} \AgdaSymbol{→} \AgdaBound{t} \AgdaField{∙} \AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r} \AgdaBound{eq}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[14]\AgdaIndent{48}{}\<[48]%
\>[48]\AgdaSymbol{((}\AgdaFunction{measure-maybe-digit} \AgdaBound{l}\AgdaSymbol{)} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaFunction{measure-maybe-digit} \AgdaBound{r}\AgdaSymbol{)} \AgdaField{∙} \AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\<%
\\
\>[14]\AgdaIndent{48}{}\<[48]%
\>[48]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{t} \AgdaSymbol{→} \AgdaBound{t} \AgdaField{∙} \AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{((}\AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{l}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{r}\AgdaSymbol{)))} \AgdaFunction{⟩}\<%
\\
\>[14]\AgdaIndent{48}{}\<[48]%
\>[48]\AgdaSymbol{((}\AgdaFunction{measure-maybe-digit} \AgdaBound{l} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaFunction{measure-maybe-digit} \AgdaBound{r}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[14]\AgdaIndent{48}{}\<[48]%
\>[48]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{l} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{r}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[14]\AgdaIndent{48}{}\<[48]%
\>[48]\AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{l} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{r} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))}\<%
\\
\>[14]\AgdaIndent{48}{}\<[48]%
\>[48]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{l}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{r} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)))} \AgdaFunction{⟩}\<%
\\
\>[14]\AgdaIndent{48}{}\<[48]%
\>[48]\AgdaFunction{measure-maybe-digit} \AgdaBound{l} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{r} \AgdaField{∙} \AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[14]\AgdaIndent{48}{}\<[48]%
\>[48]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{t} \AgdaSymbol{→} \AgdaBound{t} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{r} \AgdaField{∙} \AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{measure-to-tree-maybe-dig-lemma} \AgdaBound{l}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[14]\AgdaIndent{48}{}\<[48]%
\>[48]\AgdaFunction{measure-tree} \AgdaSymbol{(}\AgdaFunction{toTree-maybe-dig} \AgdaBound{l}\AgdaSymbol{)} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{r} \AgdaField{∙} \AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)} \AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{split-Tree1} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaComment{-- predicate and initial value}\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{pr} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaSymbol{(}\AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\})} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{sf} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaComment{-- flattened deep constructor}\<%
\\
\>[0]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaDatatype{Split-d} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{(}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{μ} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)\}} \AgdaComment{-- result}\<%
\\
\>\AgdaFunction{split-Tree1} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaKeyword{with} \AgdaFunction{splitDigit} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaSymbol{|} \AgdaFunction{inspect} \AgdaSymbol{(}\AgdaFunction{splitDigit} \AgdaBound{p} \AgdaBound{i}\AgdaSymbol{)} \AgdaBound{pr}\<%
\\
\>\AgdaFunction{split-Tree1} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaSymbol{|} \AgdaInductiveConstructor{split} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r} \AgdaSymbol{|} \AgdaInductiveConstructor{[} \AgdaBound{eq} \AgdaInductiveConstructor{]} \AgdaKeyword{rewrite} \AgdaFunction{split-Tree1-measure-lemma} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r} \AgdaBound{eq} \AgdaSymbol{=} \AgdaInductiveConstructor{split-d} \AgdaSymbol{(}\AgdaFunction{toTree-maybe-dig} \AgdaBound{l}\AgdaSymbol{)} \AgdaBound{x} \AgdaSymbol{(}\AgdaFunction{deepL} \AgdaBound{r} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaKeyword{import} \AgdaModule{MonoidSolver}\<%
\\
%
\\
\>\AgdaFunction{assoc-lemma8} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{l}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{l}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{b} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{c} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{d} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{e} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{(}\AgdaBound{a} \AgdaField{∙} \AgdaBound{b} \AgdaField{∙} \AgdaBound{c}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{d} \AgdaField{∙} \AgdaBound{e} \AgdaDatatype{≡} \AgdaBound{a} \AgdaField{∙} \AgdaBound{b} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{c} \AgdaField{∙} \AgdaBound{d} \AgdaField{∙} \AgdaBound{e}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{assoc-lemma8} \AgdaSymbol{\{}\AgdaArgument{V} \AgdaSymbol{=} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{=} \AgdaFunction{assoc-lemma8'}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{open} \AgdaModule{MonoidSolver} \AgdaBound{V} \AgdaBound{mo}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{assoc-lemma8'} \AgdaSymbol{=} \AgdaFunction{assoc-lemma-8ms}\<%
\\
%
\\
%
\\
\>\AgdaFunction{split-Tree2-measure-lemma} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[4]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaComment{-- predicate and initial value}\<%
\\
\>[4]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{pr} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaSymbol{(}\AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\})} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{sf} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \<[86]%
\>[86]\AgdaComment{-- flattened deep constructor}\<%
\\
\>[4]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{l} \AgdaSymbol{:} \AgdaDatatype{Maybe} \AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{r} \AgdaSymbol{:} \AgdaDatatype{Maybe}\AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaComment{-- flattened split}\<%
\\
\>[4]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaFunction{splitDigit} \AgdaBound{p} \AgdaBound{i} \AgdaBound{sf} \AgdaDatatype{≡} \AgdaInductiveConstructor{split} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r}\AgdaSymbol{)} \AgdaSymbol{→} \<[51]%
\>[51]\AgdaComment{-- proof on the split}\<%
\\
\>[4]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaFunction{measure-digit} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaBound{pr} \AgdaField{∙} \AgdaBound{μ} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{pr} \AgdaField{∙} \AgdaBound{μ} \AgdaField{∙} \AgdaFunction{measure-maybe-digit} \AgdaBound{l}\AgdaSymbol{)} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaSymbol{(}\AgdaFunction{toTree-maybe-dig} \AgdaBound{r}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{split-Tree2-measure-lemma} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r} \AgdaBound{eq} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{measure-digit} \AgdaBound{pr} \AgdaField{∙} \AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{a} \AgdaSymbol{→} \AgdaFunction{measure-digit} \AgdaBound{pr} \AgdaField{∙} \AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaBound{a}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaBound{sf} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r} \AgdaBound{eq}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{measure-digit} \AgdaBound{pr} \AgdaField{∙} \AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-maybe-digit} \AgdaBound{l} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaFunction{measure-maybe-digit} \AgdaBound{r}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{assoc-lemma8} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{l}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{r}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{pr} \AgdaField{∙} \AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-maybe-digit} \AgdaBound{l}\AgdaSymbol{)} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaFunction{measure-maybe-digit} \AgdaBound{r}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{split-Tree2} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{pr} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaSymbol{(}\AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\})} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{sf} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaDatatype{Split-d} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{(}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{μ} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)\}}\<%
\\
\>\AgdaFunction{split-Tree2} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaKeyword{with} \AgdaFunction{splitDigit} \AgdaBound{p} \AgdaBound{i} \AgdaBound{sf} \AgdaSymbol{|} \AgdaFunction{inspect} \AgdaSymbol{(}\AgdaFunction{splitDigit} \AgdaBound{p} \AgdaBound{i}\AgdaSymbol{)} \AgdaBound{sf}\<%
\\
\>\AgdaFunction{split-Tree2} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaSymbol{|} \AgdaInductiveConstructor{split} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r} \AgdaSymbol{|} \AgdaInductiveConstructor{[} \AgdaBound{eq} \AgdaInductiveConstructor{]} \AgdaKeyword{rewrite} \AgdaFunction{split-Tree2-measure-lemma} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r} \AgdaBound{eq} \AgdaSymbol{=} \AgdaInductiveConstructor{split-d} \AgdaSymbol{(}\AgdaFunction{deepR} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{l}\AgdaSymbol{)} \AgdaBound{x} \AgdaSymbol{(}\AgdaFunction{toTree-maybe-dig} \AgdaBound{r}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaKeyword{mutual}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree-single} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaComment{-- type class information}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaComment{-- predicate and inital value}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{e} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaDatatype{Split-d} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaField{∥} \AgdaBound{e} \AgdaField{∥}\AgdaSymbol{\})}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree-single} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaBound{p} \AgdaBound{i} \AgdaBound{e} \AgdaKeyword{rewrite} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{Monoid.ε-right} \AgdaBound{mo} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{e} \AgdaField{∥}\AgdaSymbol{))} \AgdaSymbol{|}\<%
\\
\>[2]\AgdaIndent{34}{}\<[34]%
\>[34]\AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{Monoid.ε-left} \AgdaBound{mo} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{e} \AgdaField{∥} \AgdaField{∙} \AgdaField{ε}\AgdaSymbol{))} \AgdaSymbol{=} \AgdaInductiveConstructor{split-d} \AgdaInductiveConstructor{Empty} \AgdaBound{e} \AgdaInductiveConstructor{Empty}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaComment{-- type class information}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaComment{-- predicate and inital value}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\})} \AgdaComment{-- argument}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaDatatype{Maybe} \AgdaSymbol{(}\AgdaDatatype{Split-d} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\})}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree} \AgdaBound{p} \AgdaBound{i} \AgdaInductiveConstructor{Empty}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{=} \AgdaInductiveConstructor{nothing} \<[15]%
\>[15]\AgdaComment{-- cannot split an empty tree}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Single} \AgdaBound{e}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{=} \AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaFunction{split-Tree-single} \AgdaBound{p} \AgdaBound{i} \AgdaBound{e}\AgdaSymbol{)} \AgdaComment{-- superfluous case}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{=} \AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaFunction{split-Tree-if} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaFunction{vpr} \AgdaInductiveConstructor{refl} \AgdaFunction{vft} \AgdaInductiveConstructor{refl}\AgdaSymbol{)} \AgdaComment{-- recursive case}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{vpr} \AgdaSymbol{=} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{))}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{vft} \AgdaSymbol{=} \AgdaBound{p} \AgdaSymbol{((}\AgdaBound{i} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaField{∙} \AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{measure-node-digit-lemma} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{28}{}\<[28]%
\>[28]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{28}{}\<[28]%
\>[28]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{28}{}\<[28]%
\>[28]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{n} \AgdaSymbol{:} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{28}{}\<[28]%
\>[28]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{measure-node} \AgdaBound{n} \AgdaDatatype{≡} \AgdaFunction{measure-digit} \AgdaSymbol{(}\AgdaFunction{toDigit} \AgdaBound{n}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{measure-node-digit-lemma} \AgdaSymbol{(}\AgdaInductiveConstructor{Node2} \AgdaBound{v} \AgdaBound{x} \AgdaBound{y} \AgdaBound{p}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{p}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{measure-node-digit-lemma} \AgdaSymbol{(}\AgdaInductiveConstructor{Node3} \AgdaBound{v} \AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaBound{p}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{p}\<%
\\
%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{assoc-lemma9} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{l}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{l}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{b} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{c} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{d} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{e} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{g} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaField{∙} \AgdaBound{b} \AgdaField{∙} \AgdaBound{c}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{d} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{e} \AgdaField{∙} \AgdaBound{f} \AgdaField{∙} \AgdaBound{g}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaBound{a} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{b} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{c} \AgdaField{∙} \AgdaBound{d} \AgdaField{∙} \AgdaBound{e}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{f}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{g}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{assoc-lemma9} \AgdaSymbol{\{}\AgdaArgument{V} \AgdaSymbol{=} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{=} \AgdaFunction{assoc-lemma9'}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaKeyword{open} \AgdaModule{MonoidSolver} \AgdaBound{V} \AgdaBound{mo}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{assoc-lemma9'} \AgdaSymbol{=} \AgdaFunction{assoc-lemma-9ms}\<%
\\
%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree3-measure-lemma} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{μ₁} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}\{}\AgdaBound{μ₂} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}→}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaBound{pr} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{sf} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \<[51]%
\>[51]\AgdaComment{-- flattened deep constructor}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaBound{ml} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaSymbol{(}\AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ₁}\AgdaSymbol{\})} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{mx} \AgdaSymbol{:} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{mr} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaSymbol{(}\AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ₂}\AgdaSymbol{\})} \AgdaSymbol{→} \AgdaComment{-- flattened split of ft}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaBound{l} \AgdaSymbol{:} \AgdaDatatype{Maybe} \AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{r} \AgdaSymbol{:} \AgdaDatatype{Maybe} \AgdaSymbol{(}\AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaComment{-- flattened split of mx}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaFunction{splitDigit} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr} \AgdaField{∙} \AgdaFunction{measure-tree} \AgdaBound{ml}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{toDigit} \AgdaBound{mx}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaInductiveConstructor{split} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaComment{-- proof that the flattened split of mx is correct.}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{((}\AgdaFunction{measure-digit} \AgdaBound{pr} \AgdaField{∙} \AgdaSymbol{(}\AgdaBound{μ₁} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-node} \AgdaBound{mx}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{μ₂}\AgdaSymbol{)} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)} \AgdaDatatype{≡}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{pr} \AgdaField{∙} \AgdaBound{μ₁} \AgdaField{∙} \AgdaFunction{measure-maybe-digit} \AgdaBound{l}\AgdaSymbol{)} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{r} \AgdaField{∙} \AgdaBound{μ₂} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{))} \AgdaComment{-- associativity lemma required}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree3-measure-lemma} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{sf} \AgdaBound{ml} \AgdaBound{mx} \AgdaBound{mr} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r} \AgdaBound{prf2} \AgdaSymbol{=}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{begin}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaFunction{σpr} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{μ₁} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-node} \AgdaBound{mx}\AgdaSymbol{)} \AgdaField{∙} \AgdaFunction{μ₂}\AgdaSymbol{)} \AgdaField{∙} \AgdaFunction{σsf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{a} \AgdaSymbol{→} \AgdaFunction{σpr} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{μ₁} \AgdaField{∙} \AgdaBound{a} \AgdaField{∙} \AgdaFunction{μ₂}\AgdaSymbol{)} \AgdaField{∙} \AgdaFunction{σsf}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-node-digit-lemma} \AgdaBound{mx}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaFunction{σpr} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{μ₁} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaSymbol{(}\AgdaFunction{toDigit} \AgdaBound{mx}\AgdaSymbol{))} \AgdaField{∙} \AgdaFunction{μ₂}\AgdaSymbol{)} \AgdaField{∙} \AgdaFunction{σsf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{a} \AgdaSymbol{→} \AgdaFunction{σpr} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{μ₁} \AgdaField{∙} \AgdaBound{a} \AgdaField{∙} \AgdaFunction{μ₂}\AgdaSymbol{)} \AgdaField{∙} \AgdaFunction{σsf}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{splitDigit-size-lemma0} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaFunction{σpr} \AgdaField{∙} \AgdaFunction{μ₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{toDigit} \AgdaBound{mx}\AgdaSymbol{)} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r} \AgdaBound{prf2}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{σpr} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{μ₁} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{l} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaFunction{measure-maybe-digit} \AgdaBound{r}\AgdaSymbol{)} \AgdaField{∙} \AgdaFunction{μ₂}\AgdaSymbol{)} \AgdaField{∙} \AgdaFunction{σsf}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{assoc-lemma9} \AgdaFunction{σpr} \AgdaFunction{μ₁} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{l}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{r}\AgdaSymbol{)} \AgdaFunction{μ₂} \AgdaFunction{σsf}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaFunction{σpr} \AgdaField{∙} \AgdaFunction{μ₁} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{l}\AgdaSymbol{))} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-maybe-digit} \AgdaBound{r} \AgdaField{∙} \AgdaFunction{μ₂} \AgdaField{∙} \AgdaFunction{σsf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{∎}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaKeyword{where}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{σpr} \AgdaSymbol{=} \AgdaFunction{measure-digit} \AgdaBound{pr}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{σsf} \AgdaSymbol{=} \AgdaFunction{measure-digit} \AgdaBound{sf}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{μ₁} \AgdaSymbol{=} \AgdaFunction{measure-tree} \AgdaBound{ml}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{μ₂} \AgdaSymbol{=} \AgdaFunction{measure-tree} \AgdaBound{mr}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree3} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaBound{pr} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaSymbol{(}\AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\})} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{sf} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaInductiveConstructor{false}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{((}\AgdaBound{i} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{μ}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaInductiveConstructor{true}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaDatatype{Split-d} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{(}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{μ} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree3} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaBound{eq1} \AgdaBound{eq2}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaFunction{split-Tree} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaBound{ft}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaFunction{inspect} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaFunction{split-Tree} \AgdaBound{x} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaBound{ft}\AgdaSymbol{)} \AgdaBound{p}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- inspect here is needed to enforce structure-measure-lemma1.}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree3} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaBound{eq1} \AgdaBound{eq2}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{split-d} \AgdaBound{ml} \AgdaBound{mx} \AgdaBound{mr}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaSymbol{\_}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaFunction{splitDigit} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr} \AgdaField{∙} \AgdaFunction{measure-tree} \AgdaBound{ml}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{toDigit} \AgdaBound{mx}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaFunction{inspect} \AgdaSymbol{(}\AgdaFunction{splitDigit} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr} \AgdaField{∙} \AgdaFunction{measure-tree} \AgdaBound{ml}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{toDigit} \AgdaBound{mx}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree3} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaBound{eq1} \AgdaBound{eq2}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{just} \AgdaSymbol{(}\AgdaInductiveConstructor{split-d} \AgdaBound{ml} \AgdaBound{mx} \AgdaBound{mr}\AgdaSymbol{)} \AgdaSymbol{|} \AgdaSymbol{\_}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{split} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r} \AgdaSymbol{|} \AgdaInductiveConstructor{[} \AgdaBound{eq} \AgdaInductiveConstructor{]}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{rewrite} \AgdaFunction{split-Tree3-measure-lemma} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{sf} \AgdaBound{ml} \AgdaBound{mx} \AgdaBound{mr} \AgdaBound{l} \AgdaBound{x} \AgdaBound{r} \AgdaBound{eq}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{=} \AgdaInductiveConstructor{split-d} \AgdaSymbol{(}\AgdaFunction{deepR} \AgdaBound{pr} \AgdaBound{ml} \AgdaBound{l}\AgdaSymbol{)} \AgdaBound{x} \AgdaSymbol{(}\AgdaFunction{deepL} \AgdaBound{r} \AgdaBound{mr} \AgdaBound{sf}\AgdaSymbol{)} \AgdaComment{--}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- see explanation at structure-measure-lemma1}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree3} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaBound{eq1} \AgdaBound{eq2}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{nothing}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{|} \AgdaInductiveConstructor{[} \AgdaBound{eq} \AgdaInductiveConstructor{]}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{with} \AgdaFunction{structure-measure-lemma1} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{eq1} \AgdaBound{eq2} \AgdaBound{eq}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree3} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaBound{eq1} \AgdaBound{eq2} \AgdaSymbol{|} \AgdaInductiveConstructor{nothing} \AgdaSymbol{|} \AgdaInductiveConstructor{[} \AgdaBound{eq} \AgdaInductiveConstructor{]} \AgdaSymbol{|} \AgdaSymbol{()}\<%
\\
%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree-if} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \<[44]%
\>[44]\AgdaComment{-- predicate and initial value}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{pr} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \<[45]%
\>[45]\AgdaComment{-- prefix}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaSymbol{(}\AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\})} \AgdaComment{-- nested tree}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{sf} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \<[43]%
\>[43]\AgdaComment{-- suffix}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{vpr} \AgdaSymbol{:} \AgdaDatatype{Bool}\AgdaSymbol{)} \<[43]%
\>[43]\AgdaComment{-- value of predicate after prefix}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{vpr} \AgdaDatatype{≡} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{))} \AgdaComment{-- correctness check}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{vft} \AgdaSymbol{:} \AgdaDatatype{Bool}\AgdaSymbol{)} \<[43]%
\>[43]\AgdaComment{-- value of predicate after tree}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{vft} \AgdaDatatype{≡} \AgdaBound{p} \AgdaSymbol{((}\AgdaBound{i} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{)))} \AgdaComment{-- check}\<%
\\
\>[2]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaSymbol{→} \AgdaDatatype{Split-d} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{(}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{μ} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)\}}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree-if} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaInductiveConstructor{false} \AgdaBound{pr1} \AgdaInductiveConstructor{false} \AgdaBound{pr2}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{=} \AgdaFunction{split-Tree2} \AgdaBound{p} \AgdaSymbol{((}\AgdaBound{i} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{))} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaComment{-- case2 : predicate becomes true in suffix or it doesn't become true at all}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree-if} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaInductiveConstructor{false} \AgdaBound{pr1} \AgdaInductiveConstructor{true} \AgdaBound{pr2}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{=} \AgdaFunction{split-Tree3} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{pr1}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaBound{pr2}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaComment{-- case3 : predicate becomes true in tree}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-Tree-if} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf} \AgdaInductiveConstructor{true} \AgdaBound{pr1} \AgdaBound{vft} \AgdaBound{pr2}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{=} \AgdaFunction{split-Tree1} \AgdaBound{p} \AgdaBound{i} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaComment{-- case1 : predicate becomes true in prefix}\<%
\\
%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- agda limitation: in the presence of rewrite, the typechecker gets a bit muddled. This is the reason why I am avoiding it at all}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- cost in splitTree.}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-lemma-empty} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaComment{-- type class information}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaComment{-- predicate and inital value}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\})} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaFunction{split-Tree} \AgdaBound{p} \AgdaBound{i} \AgdaBound{ft} \AgdaDatatype{≡} \AgdaInductiveConstructor{nothing}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{μ} \AgdaDatatype{≡} \AgdaField{ε}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-lemma-empty} \AgdaBound{p} \AgdaBound{i} \AgdaInductiveConstructor{Empty} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-lemma-empty} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Single} \AgdaBound{e}\AgdaSymbol{)} \AgdaSymbol{()}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{split-lemma-empty} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{()}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{prop-monoid-lemma} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→} \AgdaComment{-- type class information}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \<[52]%
\>[52]\AgdaComment{-- predicate and inital value}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{μ} \AgdaDatatype{≡} \AgdaField{ε}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{p} \AgdaBound{i} \AgdaDatatype{≡} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaBound{μ}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{prop-monoid-lemma} \AgdaBound{p} \AgdaBound{i} \AgdaSymbol{\_} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{p} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{ε-right} \AgdaBound{i}\AgdaSymbol{))}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{structure-measure-lemma0} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaComment{-- type class information}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaComment{-- predicate and inital value}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\})} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{p} \AgdaBound{i} \AgdaDatatype{≡} \AgdaInductiveConstructor{false}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaBound{μ}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaInductiveConstructor{true}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{μ} \AgdaFunction{≢} \AgdaField{ε}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{structure-measure-lemma0} \AgdaSymbol{\{}\AgdaArgument{μ} \AgdaSymbol{=} \AgdaBound{μ}\AgdaSymbol{\}} \AgdaBound{p} \AgdaBound{i} \AgdaBound{ft} \AgdaBound{v1} \AgdaBound{v2} \AgdaSymbol{=} \AgdaFunction{contraposition} \AgdaSymbol{(}\AgdaFunction{prop-monoid-lemma} \AgdaBound{p} \AgdaBound{i} \AgdaBound{μ}\AgdaSymbol{)} \AgdaFunction{diff}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{neq-bool} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaDatatype{≡} \AgdaInductiveConstructor{false}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{y} \AgdaSymbol{:} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{y} \AgdaDatatype{≡} \AgdaInductiveConstructor{true}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaFunction{≢} \AgdaBound{y}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{neq-bool} \AgdaSymbol{.}\AgdaInductiveConstructor{false} \AgdaInductiveConstructor{refl} \AgdaSymbol{.}\AgdaInductiveConstructor{true} \AgdaInductiveConstructor{refl} \AgdaSymbol{=} \AgdaSymbol{λ} \AgdaSymbol{()}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{diff} \AgdaSymbol{:} \AgdaSymbol{(}\AgdaBound{p} \AgdaBound{i} \AgdaFunction{≢} \AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaBound{μ}\AgdaSymbol{))}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{diff} \AgdaSymbol{=} \AgdaFunction{neq-bool} \AgdaSymbol{(}\AgdaBound{p} \AgdaBound{i}\AgdaSymbol{)} \AgdaBound{v1} \AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaBound{μ}\AgdaSymbol{))} \AgdaBound{v2}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- this lemma is helping enforce the fact that an empty tree cannot cause the property p to change after iterating through it}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- I am using the fact that split-Tree only returns nothing when the arguemnt is Empty}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- however, this has caused some unnecessary problems in the previous implementation, due to termination checking.}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- I believe that the verification method here should be lazy, as in, if I am returning (just x), you don't need to compute}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- x to realize it is not equal to 'nothing'...}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{structure-measure-lemma1} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaComment{-- type class information}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{:} \AgdaBound{V} \AgdaSymbol{→} \AgdaDatatype{Bool}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{i} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaComment{-- predicate and inital value}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\})} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{p} \AgdaBound{i} \AgdaDatatype{≡} \AgdaInductiveConstructor{false}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaBound{p} \AgdaSymbol{(}\AgdaBound{i} \AgdaField{∙} \AgdaBound{μ}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaInductiveConstructor{true}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{(}\AgdaFunction{split-Tree} \AgdaBound{p} \AgdaBound{i} \AgdaBound{ft} \AgdaFunction{≢} \AgdaInductiveConstructor{nothing}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{structure-measure-lemma1} \AgdaBound{p} \AgdaBound{i} \AgdaBound{ft} \AgdaBound{p1} \AgdaBound{p2} \AgdaSymbol{=} \AgdaFunction{contraposition} \AgdaSymbol{(}\AgdaFunction{split-lemma-empty} \AgdaBound{p} \AgdaBound{i} \AgdaBound{ft}\AgdaSymbol{)} \AgdaSymbol{((}\AgdaFunction{structure-measure-lemma0} \AgdaBound{p} \AgdaBound{i} \AgdaBound{ft} \AgdaBound{p1} \AgdaBound{p2}\AgdaSymbol{))}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- test this in RandomAccessSequence first.}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- data \_<<\_ \{a\} \{A : Set a\} \{V : Set a\} ⦃ mo : Monoid V ⦄ ⦃ m : Measured A V ⦄ \{μ : V\} \{σ : V\} :}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{--     (ft1 : FingerTree A V \{μ\}) → (ft2 : FingerTree A V \{σ\}) → Set a where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{--     sz : ∀ (ft1 : FingerTree A V \{μ\}) (ft2 : FingerTree A V \{σ\}) → (μ ≲ σ) → ft1 << ft2}\<%
\\
%
\\
%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{-- toList-view-lemma1 : ∀ \{a\} \{A : Set a\} \{V : Set a\} ⦃ mo : Monoid V ⦄ ⦃ m : Measured A V ⦄}\<%
\\
\>\AgdaComment{--               \{μ : V\} →}\<%
\\
\>\AgdaComment{--               (ft : FingerTree A V \{μ\}) →}\<%
\\
\>\AgdaComment{--               (toList-view (viewL ft) ≡ toList-ft ft)}\<%
\\
\>\AgdaComment{-- toList-view-lemma1 ft with viewL ft}\<%
\\
\>\AgdaComment{-- toList-view-lemma1 \{μ = .ε\} ft | NilL}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{-- postulate ftstr-lemma0 : ∀ \{a\} \{A : Set a\} \{V : Set a\} ⦃ mo : Monoid V ⦄ ⦃ m : Measured A V ⦄}\<%
\\
\>\AgdaComment{--             (ft : FingerTree A V \{ε\}) → (ft ≡ Empty)}\<%
\\
%
\\
\>\AgdaComment{-- toList-view-lemma2 : ∀ \{a\} \{A : Set a\} \{V : Set a\} ⦃ mo : Monoid V ⦄ ⦃ m : Measured A V ⦄}\<%
\\
\>\AgdaComment{--               \{μ : V\} → (x : A) → (xs : FingerTree A V \{μ\}) → (toList-ft (x ◁ xs)) ≡ (x ∷ toList-ft xs)}\<%
\\
\>\AgdaComment{-- toList-view-lemma2 \{μ = μ\} x xs with viewL xs}\<%
\\
\>\AgdaComment{-- toList-view-lemma2 \{a = a\} \{A = A\} \{V = V\} ⦃ mo = mo ⦄ ⦃ m = m ⦄  x xs | NilL rewrite ftstr-lemma0 xs |}\<%
\\
\>\AgdaComment{--                                            (Monoid.ε-right mo) ∥ x ∥ = \{!   !\}}\<%
\\
%
\\
\>\AgdaComment{-- C+c C+n in the hole above with}\<%
\\
\>\AgdaComment{-- \_◁\_ \{a\} \{A\} \{V\} \{\{mo\}\} \{\{m\}\} \{Monoid.ε mo\} x Empty}\<%
\\
\>\AgdaComment{--  | Measured.∥ m ∥ x | refl}\<%
\\
\>\AgdaComment{-- Error - not implemented}\<%
\\
%
\\
%
\\
\>\AgdaComment{-- would be amazing to prove that foldl is measure.}\<%
\\
%
\\
\>\AgdaFunction{foldr-dig} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{A} \AgdaSymbol{→} \AgdaBound{V} \AgdaSymbol{→} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Digit} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{V} \AgdaSymbol{→} \AgdaBound{V}\<%
\\
\>\AgdaFunction{foldr-dig} \AgdaBound{f} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{i} \AgdaSymbol{=} \AgdaBound{f} \AgdaBound{x} \AgdaBound{i}\<%
\\
\>\AgdaFunction{foldr-dig} \AgdaBound{f} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaBound{i} \AgdaSymbol{=} \AgdaBound{f} \AgdaBound{x} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{x₁} \AgdaBound{i}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{foldr-dig} \AgdaBound{f} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaBound{i} \AgdaSymbol{=} \AgdaBound{f} \AgdaBound{x} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{x₁} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{x₂} \AgdaBound{i}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{foldr-dig} \AgdaBound{f} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaBound{i} \AgdaSymbol{=} \AgdaBound{f} \AgdaBound{x} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{x₁} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{x₂} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{x₃} \AgdaBound{i}\AgdaSymbol{)))}\<%
\\
%
\\
\>\AgdaFunction{foldl-dig} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{W} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{W} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{W}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{W} \AgdaSymbol{→} \AgdaDatatype{Digit} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{W}\<%
\\
\>\AgdaFunction{foldl-dig} \AgdaBound{f} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{f} \AgdaBound{i} \AgdaBound{x}\<%
\\
\>\AgdaFunction{foldl-dig} \AgdaBound{f} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{f} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{i} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{x₁}\<%
\\
\>\AgdaFunction{foldl-dig} \AgdaBound{f} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{f} \AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{i} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaBound{x₂}\<%
\\
\>\AgdaFunction{foldl-dig} \AgdaBound{f} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{f} \AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{i} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaBound{x₃}\<%
\\
%
\\
\>\AgdaFunction{foldl-node} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{W} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{:} \AgdaBound{W} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{W}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{W} \AgdaSymbol{→} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{→} \AgdaBound{W}\<%
\\
\>\AgdaFunction{foldl-node} \AgdaBound{f} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Node2} \AgdaBound{v} \AgdaBound{x} \AgdaBound{y} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{f} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{i} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{y}\<%
\\
\>\AgdaFunction{foldl-node} \AgdaBound{f} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Node3} \AgdaBound{v} \AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{f} \AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{i} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{y}\AgdaSymbol{)} \AgdaBound{z}\<%
\\
%
\\
\>\AgdaFunction{foldr-node} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{A} \AgdaSymbol{→} \AgdaBound{V} \AgdaSymbol{→} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{→} \AgdaBound{V} \AgdaSymbol{→} \AgdaBound{V}\<%
\\
\>\AgdaFunction{foldr-node} \AgdaBound{f} \AgdaSymbol{(}\AgdaInductiveConstructor{Node2} \AgdaBound{v} \AgdaBound{x} \AgdaBound{y} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaBound{i} \AgdaSymbol{=} \AgdaBound{f} \AgdaBound{x} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{y} \AgdaBound{i}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{foldr-node} \AgdaBound{f} \AgdaSymbol{(}\AgdaInductiveConstructor{Node3} \AgdaBound{v} \AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaBound{i} \AgdaSymbol{=} \AgdaBound{f} \AgdaBound{x} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{y} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{z} \AgdaBound{i}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaFunction{foldr} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{\{}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{A} \AgdaSymbol{→} \AgdaBound{V} \AgdaSymbol{→} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{s}\AgdaSymbol{\}}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{V}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{V}\<%
\\
\>\AgdaFunction{foldr} \AgdaBound{f} \AgdaInductiveConstructor{Empty} \AgdaBound{i} \AgdaSymbol{=} \AgdaBound{i}\<%
\\
\>\AgdaFunction{foldr} \AgdaBound{f} \AgdaSymbol{(}\AgdaInductiveConstructor{Single} \AgdaBound{e}\AgdaSymbol{)} \AgdaBound{i} \AgdaSymbol{=} \AgdaBound{f} \AgdaBound{e} \AgdaBound{i}\<%
\\
\>\AgdaFunction{foldr} \AgdaBound{f} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)} \AgdaBound{i} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{foldr-dig} \AgdaBound{f} \AgdaBound{pr} \AgdaSymbol{(}\AgdaFunction{foldr} \AgdaSymbol{(}\AgdaFunction{foldr-node} \AgdaBound{f}\AgdaSymbol{)} \AgdaBound{ft} \AgdaSymbol{(}\AgdaFunction{foldr-dig} \AgdaBound{f} \AgdaBound{sf} \AgdaBound{i}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaFunction{foldfun} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(}\AgdaBound{v} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{V}\<%
\\
\>\AgdaFunction{foldfun} \AgdaBound{v} \AgdaBound{x} \AgdaSymbol{=} \AgdaBound{v} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\<%
\\
%
\\
\>\AgdaFunction{foldfun-node} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{(}\AgdaBound{v} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaBound{V}\<%
\\
\>\AgdaFunction{foldfun-node} \AgdaBound{v} \AgdaBound{x} \AgdaSymbol{=} \AgdaBound{v} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-node} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{foldl} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{\{}\AgdaBound{W} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{\{}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{W} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{W}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{W}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{s}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaBound{W}\<%
\\
\>\AgdaFunction{foldl} \AgdaBound{f} \AgdaBound{i} \AgdaInductiveConstructor{Empty} \AgdaSymbol{=} \AgdaBound{i}\<%
\\
\>\AgdaFunction{foldl} \AgdaBound{f} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Single} \AgdaBound{e}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{f} \AgdaBound{i} \AgdaBound{e}\<%
\\
\>\AgdaFunction{foldl} \AgdaSymbol{\{}\AgdaArgument{W} \AgdaSymbol{=} \AgdaBound{W}\AgdaSymbol{\}} \AgdaBound{f} \AgdaBound{i} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{foldl-dig} \AgdaBound{f} \AgdaSymbol{(}\AgdaFunction{foldl} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaBound{f}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{foldl-dig} \AgdaBound{f} \AgdaBound{i} \AgdaBound{pr}\AgdaSymbol{)} \AgdaBound{ft}\AgdaSymbol{)} \AgdaBound{sf}\<%
\\
%
\\
\>\AgdaComment{-- REVERSE !! ------------------------------------------------------------------}\<%
\\
%
\\
\>\AgdaFunction{pack-ft} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{s}\AgdaSymbol{\})}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaRecord{Σ} \AgdaBound{V} \AgdaSymbol{(λ} \AgdaBound{v} \AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{v}\AgdaSymbol{\}))}\<%
\\
\>\AgdaFunction{pack-ft} \AgdaBound{ft} \AgdaSymbol{=} \AgdaInductiveConstructor{⟨} \AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaInductiveConstructor{,} \AgdaBound{ft} \AgdaInductiveConstructor{⟩}\<%
\\
%
\\
\>\AgdaFunction{foldl-pair} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{W} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(} \AgdaBound{W} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{W}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaBound{W}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaRecord{Σ} \AgdaBound{V} \AgdaSymbol{(λ} \AgdaBound{v} \AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{v}\AgdaSymbol{\}))}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaBound{W}\<%
\\
\>\AgdaFunction{foldl-pair} \AgdaBound{f} \AgdaBound{s} \AgdaInductiveConstructor{⟨} \AgdaBound{μ} \AgdaInductiveConstructor{,} \AgdaBound{ft} \AgdaInductiveConstructor{⟩} \AgdaSymbol{=} \AgdaFunction{foldl} \AgdaBound{f} \AgdaBound{s} \AgdaBound{ft}\<%
\\
%
\\
\>\AgdaFunction{cons-pair} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaRecord{Σ} \AgdaBound{V} \AgdaSymbol{(λ} \AgdaBound{v} \AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{v}\AgdaSymbol{\}))}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaBound{A}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaRecord{Σ} \AgdaBound{V} \AgdaSymbol{(λ} \AgdaBound{v} \AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{v}\AgdaSymbol{\}))}\<%
\\
\>\AgdaFunction{cons-pair} \AgdaInductiveConstructor{⟨} \AgdaBound{measure} \AgdaInductiveConstructor{,} \AgdaBound{ft} \AgdaInductiveConstructor{⟩} \AgdaBound{x} \AgdaSymbol{=} \AgdaFunction{pack-ft} \AgdaSymbol{(}\AgdaBound{x} \AgdaFunction{◁} \AgdaBound{ft}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{reverse-ft} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaRecord{Σ} \AgdaBound{V} \AgdaSymbol{(λ} \AgdaBound{v} \AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{v}\AgdaSymbol{\}))}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaRecord{Σ} \AgdaBound{V} \AgdaSymbol{(λ} \AgdaBound{v} \AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{v}\AgdaSymbol{\}))}\<%
\\
\>\AgdaFunction{reverse-ft} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaBound{pair} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{foldl-pair} \AgdaFunction{cons-pair} \AgdaSymbol{(}\AgdaFunction{pack-ft} \AgdaSymbol{\{}\AgdaArgument{A} \AgdaSymbol{=} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{V} \AgdaSymbol{=} \AgdaBound{V}\AgdaSymbol{\}} \AgdaInductiveConstructor{Empty}\AgdaSymbol{)} \AgdaBound{pair}\<%
\\
%
\\
\>\AgdaComment{-- CORRECTNESS PROOFS --------------------------------------}\<%
\\
%
\\
\>\AgdaFunction{assoc-lemma5} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{l}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{l}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{b} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{c} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{d} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \<[47]%
\>[47]\AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(((}\AgdaBound{a} \AgdaField{∙} \AgdaBound{b}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{c}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{d}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaBound{a} \AgdaField{∙} \AgdaBound{b} \AgdaField{∙} \AgdaBound{c} \AgdaField{∙} \AgdaBound{d}\<%
\\
\>\AgdaFunction{assoc-lemma5} \AgdaSymbol{\{}\AgdaBound{l}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{=} \AgdaFunction{assoc-lemma5'}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{where}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{open} \AgdaModule{MonoidSolver} \AgdaBound{V} \AgdaBound{mo}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{assoc-lemma5'} \AgdaSymbol{=} \AgdaFunction{assoc-lemma0ms}\<%
\\
%
\\
\>\AgdaFunction{assoc-lemma6} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{l}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{l}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[4]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{b} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{c} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{d} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{e} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[4]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{→} \AgdaSymbol{(((((}\AgdaBound{a} \AgdaField{∙} \AgdaBound{b}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{c}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{d}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{e}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaBound{a} \AgdaField{∙} \AgdaBound{b} \AgdaField{∙} \AgdaBound{c} \AgdaField{∙} \AgdaBound{d} \AgdaField{∙} \AgdaBound{e}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{assoc-lemma6} \AgdaSymbol{\{}\AgdaArgument{V} \AgdaSymbol{=} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{=} \AgdaFunction{assoc-lemma6'}\<%
\\
\>[0]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaKeyword{where}\<%
\\
\>[3]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaKeyword{open} \AgdaModule{MonoidSolver} \AgdaBound{V} \AgdaBound{mo}\<%
\\
\>[3]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{assoc-lemma6'} \AgdaSymbol{=} \AgdaFunction{assoc-lemma-5ms}\<%
\\
%
\\
\>\AgdaFunction{assoc-lemma7} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{l}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{l}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[6]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{a} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{b} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[6]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaField{ε} \AgdaField{∙} \AgdaBound{a}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{b} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{a} \AgdaField{∙} \AgdaField{ε}\AgdaSymbol{)} \AgdaField{∙} \AgdaBound{b}\<%
\\
\>\AgdaFunction{assoc-lemma7} \AgdaSymbol{\{}\AgdaArgument{V} \AgdaSymbol{=} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{=} \AgdaFunction{assoc-lemma7'}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaKeyword{where}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaKeyword{open} \AgdaModule{MonoidSolver} \AgdaBound{V} \AgdaBound{mo}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{assoc-lemma7'} \AgdaSymbol{=} \AgdaFunction{assoc-lemma-7ms}\<%
\\
%
\\
\>\AgdaFunction{foldl-node-lemma0} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{v} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{node} \AgdaSymbol{:} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaFunction{foldfun} \AgdaBound{v} \AgdaBound{node}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{v} \AgdaField{∙} \AgdaFunction{measure-node} \AgdaBound{node}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{foldl-node-lemma0} \AgdaBound{v} \AgdaSymbol{(}\AgdaInductiveConstructor{Node2} \AgdaSymbol{\_} \AgdaBound{x} \AgdaBound{y} \AgdaInductiveConstructor{refl}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaBound{v} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{y} \AgdaField{∥}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{foldl-node-lemma0} \AgdaBound{v} \AgdaSymbol{(}\AgdaInductiveConstructor{Node3} \AgdaSymbol{\_} \AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaInductiveConstructor{refl}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaSymbol{(}\AgdaFunction{assoc-lemma5} \AgdaBound{v} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{y} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{z} \AgdaField{∥}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaKeyword{postulate} \AgdaPostulate{FunExt} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{g} \AgdaSymbol{:} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{x} \AgdaDatatype{≡} \AgdaBound{g} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f} \AgdaDatatype{≡} \AgdaBound{g}\AgdaSymbol{)}\<%
\\
\>\AgdaKeyword{postulate} \AgdaPostulate{FunExt₂} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{B} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{C} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{f} \AgdaBound{g} \AgdaSymbol{:} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{B} \AgdaSymbol{→} \AgdaBound{C}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{((}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{y} \AgdaSymbol{:} \AgdaBound{B}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f} \AgdaBound{x} \AgdaBound{y} \AgdaDatatype{≡} \AgdaBound{g} \AgdaBound{x} \AgdaBound{y}\AgdaSymbol{))} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f} \AgdaDatatype{≡} \AgdaBound{g}\AgdaSymbol{)}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{-- foldl-node-lemma0' : ∀}\<%
\\
%
\\
\>\AgdaFunction{foldl-node-lemma1} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaSymbol{\{}\AgdaArgument{A} \AgdaSymbol{=} \AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{V} \AgdaSymbol{=} \AgdaBound{V}\AgdaSymbol{\}} \AgdaFunction{foldfun} \AgdaDatatype{≡} \AgdaSymbol{λ} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaBound{n} \AgdaSymbol{→} \AgdaBound{x} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-node} \AgdaSymbol{\{}\AgdaArgument{V} \AgdaSymbol{=} \AgdaBound{V}\AgdaSymbol{\}} \AgdaBound{n}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{foldl-node-lemma1} \AgdaSymbol{\{\_\}} \AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{=} \AgdaPostulate{FunExt₂} \AgdaSymbol{\{}\AgdaArgument{A} \AgdaSymbol{=} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaArgument{B} \AgdaSymbol{=} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{\}} \AgdaFunction{foldl-node-lemma0}\<%
\\
%
\\
%
\\
\>\AgdaFunction{foldl-dig-lemma0} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{v} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{dig} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{foldl-dig} \AgdaFunction{foldfun} \AgdaBound{v} \AgdaBound{dig} \AgdaDatatype{≡} \AgdaBound{v} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{dig}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{foldl-dig-lemma0} \AgdaBound{v} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{foldl-dig-lemma0} \AgdaBound{v} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{∙-assoc} \AgdaBound{v} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{foldl-dig-lemma0} \AgdaBound{v} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{assoc-lemma5} \AgdaBound{v} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{foldl-dig-lemma0} \AgdaBound{v} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{assoc-lemma6} \AgdaBound{v} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₁} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₂} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x₃} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{foldl-dig-correct} \AgdaSymbol{:} \<[22]%
\>[22]\AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{W} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{:} \AgdaBound{W} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{W}\AgdaSymbol{)}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{σ} \AgdaSymbol{:} \AgdaBound{W}\AgdaSymbol{)}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{d} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{foldl-dig} \AgdaBound{f} \AgdaBound{σ} \AgdaBound{d} \AgdaDatatype{≡} \AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaFunction{toList-dig} \AgdaBound{d}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{foldl-dig-correct} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{foldl-dig-correct} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{foldl-dig-correct} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{foldl-dig-correct} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaFunction{foldl-node-correct} \AgdaSymbol{:} \<[22]%
\>[22]\AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{\{}\AgdaBound{W} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{:} \AgdaBound{W} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{W}\AgdaSymbol{)}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{σ} \AgdaSymbol{:} \AgdaBound{W}\AgdaSymbol{)}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{n} \AgdaSymbol{:} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaBound{f} \AgdaBound{σ} \AgdaBound{n} \AgdaDatatype{≡} \AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaFunction{toList-node} \AgdaBound{n}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{foldl-node-correct} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaInductiveConstructor{Node2} \AgdaBound{v} \AgdaBound{x} \AgdaBound{y} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{foldl-node-correct} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaInductiveConstructor{Node3} \AgdaBound{v} \AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
%
\\
\>\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{list-fold-proof}\<%
\\
%
\\
\>\AgdaFunction{flatten-fold-lemma} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{\{}\AgdaBound{W} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{:} \AgdaBound{W} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{W}\AgdaSymbol{)}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{σ} \AgdaSymbol{:} \AgdaBound{W}\AgdaSymbol{)}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{xs} \AgdaSymbol{:} \AgdaDatatype{List} \AgdaSymbol{(}\AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\AgdaSymbol{))}\<%
\\
\>[8]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaFunction{flatten-list} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>[14]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaDatatype{≡} \AgdaFunction{Data.List.foldl} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaBound{f}\AgdaSymbol{)} \AgdaBound{σ} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{flatten-fold-lemma} \AgdaBound{f} \AgdaBound{σ} \AgdaInductiveConstructor{[]} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{flatten-fold-lemma} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaBound{xs}\AgdaSymbol{)} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaFunction{toList-node} \AgdaBound{x} \AgdaFunction{++} \AgdaFunction{flatten-list} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{foldl-append-lemma} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaFunction{toList-node} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{flatten-list} \AgdaBound{xs}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaFunction{toList-node} \AgdaBound{x}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{flatten-list} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaBound{x} \AgdaSymbol{(}\AgdaFunction{flatten-list} \AgdaBound{xs}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{foldl-node-correct} \AgdaBound{f} \AgdaBound{σ} \AgdaBound{x}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaBound{f} \AgdaBound{σ} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{flatten-list} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{flatten-fold-lemma} \AgdaBound{f} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaBound{f} \AgdaBound{σ} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{xs} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{Data.List.foldl} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaBound{f}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaBound{f} \AgdaBound{σ} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{xs}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{foldl-correct} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{\{}\AgdaBound{W} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{f} \AgdaSymbol{:} \AgdaBound{W} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{W}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{σ} \AgdaSymbol{:} \AgdaBound{W}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{s}\AgdaSymbol{\})}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{foldl} \AgdaBound{f} \AgdaBound{σ} \AgdaBound{ft} \AgdaDatatype{≡} \AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{ft}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{foldl-correct} \AgdaBound{f} \AgdaBound{σ} \AgdaInductiveConstructor{Empty} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{foldl-correct} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaInductiveConstructor{Single} \AgdaBound{e}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{foldl-correct} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{foldl} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaInductiveConstructor{refl} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{foldl-dig} \AgdaBound{f} \AgdaSymbol{(}\AgdaFunction{foldl} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaBound{f}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{foldl-dig} \AgdaBound{f} \AgdaBound{σ} \AgdaBound{pr}\AgdaSymbol{)} \AgdaBound{ft}\AgdaSymbol{)} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaFunction{foldl-dig} \AgdaBound{f} \AgdaSymbol{(}\AgdaFunction{foldl} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaBound{f}\AgdaSymbol{)} \AgdaBound{x} \AgdaBound{ft}\AgdaSymbol{)} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{foldl-dig-correct} \AgdaBound{f} \AgdaBound{σ} \AgdaBound{pr}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{foldl-dig} \AgdaBound{f} \AgdaSymbol{(}\AgdaFunction{foldl} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaBound{f}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaFunction{toList-dig} \AgdaBound{pr}\AgdaSymbol{))} \AgdaBound{ft}\AgdaSymbol{)} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaFunction{foldl-dig} \AgdaBound{f} \AgdaBound{x} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{foldl-correct} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaBound{f}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaFunction{toList-dig} \AgdaBound{pr}\AgdaSymbol{))} \AgdaBound{ft}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{foldl-dig} \AgdaBound{f} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaBound{f}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaFunction{toList-dig} \AgdaBound{pr}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{ft}\AgdaSymbol{))} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaFunction{foldl-dig} \AgdaBound{f} \AgdaBound{x} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{flatten-fold-lemma} \AgdaBound{f} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaFunction{toList-dig} \AgdaBound{pr}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{ft}\AgdaSymbol{)))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{foldl-dig} \AgdaBound{f}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaFunction{toList-dig} \AgdaBound{pr}\AgdaSymbol{))}\<%
\\
\>[4]\AgdaIndent{5}{}\<[5]%
\>[5]\AgdaSymbol{(}\AgdaFunction{flatten-list} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{ft}\AgdaSymbol{)))}\<%
\\
\>[5]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{≡⟨} \AgdaFunction{foldl-dig-correct} \AgdaBound{f} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaFunction{toList-dig} \AgdaBound{pr}\AgdaSymbol{))}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{flatten-list} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{ft}\AgdaSymbol{)))} \AgdaBound{sf} \AgdaFunction{⟩}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{Data.List.foldl} \AgdaBound{f}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaBound{f}\<%
\\
\>[8]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaFunction{toList-dig} \AgdaBound{pr}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaFunction{flatten-list} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{ft}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{toList-dig} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{foldl-append-lemma2} \AgdaBound{f} \AgdaBound{σ} \AgdaSymbol{(}\AgdaFunction{toList-dig} \AgdaBound{pr}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{flatten-list} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{ft}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{toList-dig} \AgdaBound{sf}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaFunction{Data.List.foldl} \AgdaBound{f} \AgdaBound{σ}\<%
\\
\>[4]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{toList-dig} \AgdaBound{pr} \AgdaFunction{++} \AgdaFunction{flatten-list} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{ft}\AgdaSymbol{)} \AgdaFunction{++} \AgdaFunction{toList-dig} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{∎}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- gotta prove some properties of node and dig first -- but it's worth doing this proof}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaComment{-- (Data.List.foldl (foldl-node f) (Data.List.foldl f σ (toList-dig pr)) (toList-ft ft))}\<%
\\
%
\\
\>\AgdaFunction{foldl-lemma0} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{s} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{v} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{s}\AgdaSymbol{\})}\<%
\\
\>[2]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{foldl} \AgdaFunction{foldfun} \AgdaBound{v} \AgdaBound{ft} \AgdaDatatype{≡} \AgdaBound{v} \AgdaField{∙} \AgdaBound{s}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{foldl-lemma0} \AgdaBound{v} \AgdaInductiveConstructor{Empty} \AgdaSymbol{=} \AgdaFunction{sym} \<[28]%
\>[28]\AgdaSymbol{(}\AgdaField{ε-right} \AgdaBound{v}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{foldl-lemma0} \AgdaBound{v} \AgdaSymbol{(}\AgdaInductiveConstructor{Single} \AgdaBound{e}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{foldl-lemma0} \AgdaSymbol{\{}\AgdaArgument{A} \AgdaSymbol{=} \AgdaBound{A}\AgdaSymbol{\}} \AgdaBound{v} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{foldl} \AgdaFunction{foldfun} \AgdaBound{v} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaInductiveConstructor{refl} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{foldl-dig} \AgdaFunction{foldfun} \AgdaSymbol{(}\AgdaFunction{foldl} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaFunction{foldfun}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{foldl-dig} \AgdaFunction{foldfun} \AgdaBound{v} \AgdaBound{pr}\AgdaSymbol{)} \AgdaBound{ft}\AgdaSymbol{)} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{z} \AgdaSymbol{→} \AgdaFunction{foldl-dig} \AgdaFunction{foldfun} \AgdaSymbol{(}\AgdaFunction{foldl} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaFunction{foldfun}\AgdaSymbol{)} \AgdaBound{z} \AgdaBound{ft}\AgdaSymbol{)} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{foldl-dig-lemma0} \AgdaBound{v} \AgdaBound{pr}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaFunction{foldl-dig} \AgdaFunction{foldfun} \AgdaSymbol{(}\AgdaFunction{foldl} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaFunction{foldfun}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{v} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaBound{ft}\AgdaSymbol{)} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{foldl-dig-lemma0} \AgdaSymbol{(}\AgdaFunction{foldl} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaFunction{foldfun}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{v} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaBound{ft}\AgdaSymbol{)} \AgdaBound{sf} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaFunction{foldl} \AgdaSymbol{(}\AgdaFunction{foldl-node} \AgdaFunction{foldfun}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{v} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaBound{ft}\AgdaSymbol{)} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{z} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{foldl} \AgdaBound{z} \AgdaSymbol{(}\AgdaBound{v} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaBound{ft}\AgdaSymbol{)} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)} \AgdaFunction{foldl-node-lemma1} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{3}{}\<[3]%
\>[3]\AgdaSymbol{(}\AgdaFunction{foldl} \AgdaSymbol{(}\AgdaFunction{foldfun-node}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{v} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaBound{ft}\AgdaSymbol{)} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaBound{x} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{foldl-lemma0} \AgdaSymbol{(}\AgdaBound{v} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaBound{ft}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{((}\AgdaBound{v} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{))} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{assoc-lemma5} \AgdaBound{v} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{pr}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{v} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaBound{pr} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{-- all x → (ft : FingerTree A V \{μ\}) → (toList (x ◁ ft)) ≡ x ∷ toList ft}\<%
\\
\>\AgdaComment{-- all x → (ft : FingerTree A (List A)) → (toList (x ◁ ft)) ≡ [ x ] ++ toList ft}\<%
\\
%
\\
%
\\
\>\AgdaFunction{lemma6} \AgdaSymbol{:} \<[11]%
\>[11]\AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\})} \AgdaSymbol{→}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaSymbol{(}\AgdaBound{x} \AgdaFunction{◁} \AgdaBound{ft}\AgdaSymbol{))} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{lemma6} \AgdaBound{x} \AgdaBound{ft} \AgdaSymbol{=} \AgdaFunction{begin}\<%
\\
\>[6]\AgdaIndent{18}{}\<[18]%
\>[18]\AgdaFunction{measure-tree} \AgdaSymbol{(}\AgdaBound{x} \AgdaFunction{◁} \AgdaBound{ft}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaFunction{≡⟨} \AgdaInductiveConstructor{refl} \AgdaFunction{⟩}\<%
\\
\>[16]\AgdaIndent{18}{}\<[18]%
\>[18]\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{16}{}\<[16]%
\>[16]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{foldfun-list} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaDatatype{List} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A} \AgdaSymbol{→} \AgdaDatatype{List} \AgdaBound{A}\<%
\\
\>\AgdaFunction{foldfun-list} \AgdaBound{v} \AgdaBound{x} \AgdaSymbol{=} \AgdaBound{v} \AgdaFunction{++} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaInductiveConstructor{[]}\AgdaSymbol{)}\<%
\\
%
\\
%
\\
\>\AgdaFunction{toList1} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄} \AgdaSymbol{→}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\})} \AgdaSymbol{→} \AgdaSymbol{(}\AgdaDatatype{List} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{toList1} \AgdaBound{ft} \AgdaSymbol{=} \AgdaFunction{foldl} \AgdaFunction{foldfun-list} \AgdaInductiveConstructor{[]} \AgdaBound{ft}\<%
\\
%
\\
\>\AgdaFunction{cons-correct} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a} \AgdaSymbol{\}}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{\{}\AgdaBound{v} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{→}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)} \AgdaSymbol{→}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{(}\AgdaBound{ft} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{v}\AgdaSymbol{\})} \AgdaSymbol{→}\<%
\\
\>[6]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaFunction{toList-ft} \AgdaSymbol{(}\AgdaBound{x} \AgdaFunction{◁} \AgdaBound{ft}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaInductiveConstructor{[]}\AgdaSymbol{)} \AgdaFunction{++} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{ft}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{cons-correct} \AgdaSymbol{⦃} \AgdaArgument{mo} \AgdaSymbol{=} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaBound{x} \AgdaInductiveConstructor{Empty}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{rewrite} \AgdaSymbol{(}\AgdaField{Monoid.ε-right} \AgdaBound{mo}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{cons-correct} \AgdaSymbol{\{\_\}\{}\AgdaBound{A}\AgdaSymbol{\}\{}\AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{Single} \AgdaBound{e}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{rewrite} \AgdaFunction{assoc-lemma1} \AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{⦄} \AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{⦄} \AgdaBound{x} \AgdaBound{e}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{cons-correct} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{a}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{rewrite} \AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{cons-correct} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{a} \AgdaBound{b}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{rewrite} \AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{b} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{cons-correct} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{rewrite} \AgdaField{∙-assoc} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{a} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{b} \AgdaField{∥} \AgdaField{∙} \AgdaField{∥} \AgdaBound{c} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft} \AgdaField{∙} \AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{cons-correct} \AgdaBound{x} \AgdaSymbol{(}\AgdaInductiveConstructor{Deep} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c} \AgdaBound{d}\AgdaSymbol{)} \AgdaBound{ft} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{rewrite} \AgdaFunction{assoc-lemma2} \AgdaBound{x} \AgdaBound{a} \AgdaBound{b} \AgdaBound{c} \AgdaBound{d} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{ft}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-digit} \AgdaBound{sf}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaSymbol{=} \AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaBound{a} \AgdaInductiveConstructor{∷} \AgdaFunction{flatten-list} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaSymbol{(}\AgdaFunction{node3} \AgdaBound{b} \AgdaBound{c} \AgdaBound{d} \AgdaFunction{◁} \AgdaBound{ft}\AgdaSymbol{))} \AgdaFunction{++} \AgdaFunction{toList-dig} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{z} \AgdaSymbol{→} \AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaBound{a} \AgdaInductiveConstructor{∷} \AgdaSymbol{(}\AgdaFunction{flatten-list} \AgdaBound{z}\AgdaSymbol{)} \AgdaFunction{++} \AgdaFunction{toList-dig} \AgdaBound{sf}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{cons-correct} \AgdaSymbol{(}\AgdaFunction{node3} \AgdaBound{b} \AgdaBound{c} \AgdaBound{d}\AgdaSymbol{)} \AgdaBound{ft}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaBound{a} \AgdaInductiveConstructor{∷} \AgdaBound{b} \AgdaInductiveConstructor{∷} \AgdaBound{c} \AgdaInductiveConstructor{∷} \AgdaBound{d} \AgdaInductiveConstructor{∷} \AgdaFunction{flatten-list} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{ft}\AgdaSymbol{)} \AgdaFunction{++} \AgdaFunction{toList-dig} \AgdaBound{sf}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
%
\\
\>\AgdaComment{-- VIEWL PROOFS THAT FAILED}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{-- viewl-single-lemma : ∀ \{a\} \{A : Set a\} \{V : Set a\}}\<%
\\
\>\AgdaComment{--             ⦃ mo : Monoid V ⦄}\<%
\\
\>\AgdaComment{--             ⦃ m : Measured A V ⦄}\<%
\\
\>\AgdaComment{--             → (e : A)}\<%
\\
\>\AgdaComment{--             → (viewL \{A = A\} \{V = V\} (Single e) ≇ NilL \{A = A\} \{V = V\})}\<%
\\
\>\AgdaComment{-- viewl-single-lemma ⦃ mo ⦄ ⦃ m ⦄ e with viewL (Single e) | sym (Monoid.ε-right mo ∥ e ∥)}\<%
\\
\>\AgdaComment{-- ... | v | r = \{!   !\}}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{-- viewl-empty-lemma : ∀ \{a\} \{A : Set a\} \{V : Set a\}}\<%
\\
\>\AgdaComment{--             ⦃ mo : Monoid V ⦄}\<%
\\
\>\AgdaComment{--             ⦃ m : Measured A V ⦄}\<%
\\
\>\AgdaComment{--             → \{v : V\}}\<%
\\
\>\AgdaComment{--             → (ft : FingerTree A V \{v\})}\<%
\\
\>\AgdaComment{--             → (viewL ft ≅ NilL \{A = A\} \{V = V\})}\<%
\\
\>\AgdaComment{--             → (ft ≅ Empty \{A = A\} \{V = V\})}\<%
\\
\>\AgdaComment{-- viewl-empty-lemma Empty prop = \{!   !\}}\<%
\\
\>\AgdaComment{-- viewl-empty-lemma \{V = V\}⦃ mo ⦄ ⦃ m ⦄\{v = .(∥ e ∥)\} (Single e) prop = \{!  !\}}\<%
\\
\>\AgdaComment{-- viewl-empty-lemma (Deep pr ft sf) prop = \{!   !\}}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{-- toList-deepL-lemma : ∀ \{a\} \{A : Set a\}\{V : Set a\}}\<%
\\
\>\AgdaComment{--             ⦃ mo : Monoid V ⦄}\<%
\\
\>\AgdaComment{--             ⦃ m : Measured A V ⦄}\<%
\\
\>\AgdaComment{--             → \{v : V\}}\<%
\\
\>\AgdaComment{--             → (pr : Maybe (Digit A))}\<%
\\
\>\AgdaComment{--             → (ft : FingerTree (Node A V) V \{v\})}\<%
\\
\>\AgdaComment{--             → (sf : Digit A)}\<%
\\
\>\AgdaComment{--             → toList-ft (deepL pr ft sf) ≡ toList-maybe-dig pr}\<%
\\
\>\AgdaComment{--                                           ++ (flatten-list (toList-ft ft))}\<%
\\
\>\AgdaComment{--                                           ++ toList-dig sf}\<%
\\
\>\AgdaComment{-- toList-deepL-lemma (just x) ft sf = refl}\<%
\\
\>\AgdaComment{-- toList-deepL-lemma nothing ft sf with viewL ft}\<%
\\
\>\AgdaComment{-- toList-deepL-lemma ⦃ mo ⦄ nothing ft sf}\<%
\\
\>\AgdaComment{--   | NilL rewrite (Monoid.ε-left mo) (ε ∙ measure-digit sf)}\<%
\\
\>\AgdaComment{--            | (Monoid.ε-left mo) (measure-digit sf)}\<%
\\
\>\AgdaComment{--   = \{!   !\}}\<%
\\
\>\AgdaComment{-- toList-deepL-lemma nothing ft sf | ConsL x xs = \{!   !\}}\<%
\\
%
\\
%
\\
\>\AgdaComment{-- VIEWL PROOFS ----------------------------------------------------------------}\<%
\\
%
\\
\>\AgdaFunction{viewl-to-ft} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{v} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{vl} \AgdaSymbol{:} \AgdaDatatype{ViewL} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{v}\AgdaSymbol{\})}\<%
\\
\>[2]\AgdaIndent{12}{}\<[12]%
\>[12]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{v}\AgdaSymbol{\})}\<%
\\
\>\AgdaFunction{viewl-to-ft} \AgdaInductiveConstructor{NilL} \AgdaSymbol{=} \AgdaInductiveConstructor{Empty}\<%
\\
\>\AgdaFunction{viewl-to-ft} \AgdaSymbol{(}\AgdaInductiveConstructor{ConsL} \AgdaBound{x} \AgdaBound{xs}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x} \AgdaFunction{◁} \AgdaBound{xs}\<%
\\
%
\\
\>\AgdaFunction{toList-view} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[12]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[12]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[12]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[12]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaDatatype{ViewL} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\})}\<%
\\
\>[12]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaDatatype{List} \AgdaBound{A}\<%
\\
\>\AgdaFunction{toList-view} \AgdaInductiveConstructor{NilL} \AgdaSymbol{=} \AgdaInductiveConstructor{[]}\<%
\\
\>\AgdaFunction{toList-view} \AgdaSymbol{(}\AgdaInductiveConstructor{ConsL} \AgdaBound{x} \AgdaBound{xs}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaFunction{toList-ft} \AgdaBound{xs}\<%
\\
%
\\
\>\AgdaFunction{viewl-correct} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[12]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[12]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[12]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{\{}\AgdaBound{v} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[12]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{vl} \AgdaSymbol{:} \AgdaDatatype{ViewL} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{v}\AgdaSymbol{\})}\<%
\\
\>[12]\AgdaIndent{14}{}\<[14]%
\>[14]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{toList-view} \AgdaBound{vl} \AgdaDatatype{≡} \AgdaFunction{toList-ft} \AgdaSymbol{(}\AgdaFunction{viewl-to-ft} \AgdaBound{vl}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{viewl-correct} \AgdaInductiveConstructor{NilL} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{viewl-correct} \AgdaSymbol{(}\AgdaInductiveConstructor{ConsL} \AgdaBound{x} \AgdaBound{xs}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{cons-correct} \AgdaBound{x} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaComment{-- viewL-correct : ∀ \{a\}\{A : Set a\} \{V : Set a\}}\<%
\\
\>\AgdaComment{--               ⦃ mo : Monoid V ⦄}\<%
\\
\>\AgdaComment{--               ⦃ m : Measured A V ⦄}\<%
\\
\>\AgdaComment{--               → \{v : V\}}\<%
\\
\>\AgdaComment{--               → (ft : FingerTree A V \{v\})}\<%
\\
\>\AgdaComment{--               → (toList-view (viewL ft) ≡ toList-ft ft)}\<%
\\
\>\AgdaComment{-- viewL-correct Empty = refl}\<%
\\
\>\AgdaComment{-- viewL-correct ⦃ mo = mo ⦄ (Single e)}\<%
\\
\>\AgdaComment{--   rewrite sym (Monoid.ε-right mo (∥ e ∥))}\<%
\\
\>\AgdaComment{--   = refl}\<%
\\
\>\AgdaComment{-- viewL-correct (Deep pr ft sf)}\<%
\\
\>\AgdaComment{--   rewrite measure-digit-lemma1 pr ft sf}\<%
\\
\>\AgdaComment{--   = \{!   !\}}\<%
\\
%
\\
\>\AgdaFunction{measure-list} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{List} \AgdaBound{A}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaBound{V}\<%
\\
\>\AgdaFunction{measure-list} \AgdaInductiveConstructor{[]} \AgdaSymbol{=} \AgdaField{ε}\<%
\\
\>\AgdaFunction{measure-list} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaBound{xs}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-list} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{foldfun-lemma} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{y} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{y}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{foldfun} \AgdaBound{x} \AgdaBound{y}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{foldfun-lemma} \AgdaBound{x} \AgdaBound{y} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{x} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{y}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaInductiveConstructor{refl} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{x} \AgdaField{∙} \AgdaSymbol{(}\AgdaField{ε} \AgdaField{∙} \AgdaField{∥} \AgdaBound{y} \AgdaField{∥}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaField{∙-assoc} \AgdaBound{x} \AgdaField{ε} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{y} \AgdaField{∥}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaBound{x} \AgdaField{∙} \AgdaField{ε}\AgdaSymbol{)} \AgdaField{∙} \AgdaField{∥} \AgdaBound{y} \AgdaField{∥}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaSymbol{(}\AgdaFunction{cong} \AgdaSymbol{(}\AgdaField{\_∙} \AgdaField{∥} \AgdaBound{y} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaField{ε-right} \AgdaBound{x}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{x} \AgdaField{∙} \AgdaField{∥} \AgdaBound{y} \AgdaField{∥}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{fold-monoid-lemma} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{xs} \AgdaSymbol{:} \AgdaDatatype{List} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaField{∙} \AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{xs} \AgdaDatatype{≡} \AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaBound{x} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{fold-monoid-lemma} \AgdaBound{x} \AgdaInductiveConstructor{[]} \AgdaSymbol{=} \AgdaField{ε-right} \AgdaBound{x}\<%
\\
\>\AgdaFunction{fold-monoid-lemma} \AgdaBound{x} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{∷} \AgdaBound{xs}\AgdaSymbol{)} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{x} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaSymbol{(}\AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{y}\AgdaSymbol{)} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(}\AgdaBound{x} \AgdaField{∙\_}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{fold-monoid-lemma} \AgdaSymbol{(}\AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{y}\AgdaSymbol{)} \AgdaBound{xs}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{x} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{y}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaField{∙-assoc} \AgdaBound{x} \AgdaSymbol{(}\AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{y}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{xs}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaBound{x} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{y}\AgdaSymbol{))} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(}\AgdaField{\_∙} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{xs}\AgdaSymbol{))} \AgdaSymbol{(}\AgdaFunction{foldfun-lemma} \AgdaBound{x} \AgdaBound{y}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaFunction{foldfun} \AgdaBound{x} \AgdaBound{y}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{fold-monoid-lemma} \AgdaSymbol{(}\AgdaFunction{foldfun} \AgdaBound{x} \AgdaBound{y}\AgdaSymbol{)} \AgdaBound{xs} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaSymbol{(}\AgdaFunction{foldfun} \AgdaBound{x} \AgdaBound{y}\AgdaSymbol{)} \AgdaBound{xs}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{measure-list-lemma} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{xs} \AgdaSymbol{:} \AgdaDatatype{List} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{measure-list} \AgdaBound{xs} \AgdaDatatype{≡} \AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaSymbol{(}\AgdaField{Monoid.ε} \AgdaBound{mo}\AgdaSymbol{)} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{measure-list-lemma} \AgdaInductiveConstructor{[]} \AgdaSymbol{=} \AgdaInductiveConstructor{refl}\<%
\\
\>\AgdaFunction{measure-list-lemma} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaBound{xs}\AgdaSymbol{)} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-list} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙\_}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-list-lemma} \AgdaBound{xs}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{fold-monoid-lemma} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaBound{xs} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥} \AgdaBound{xs}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{a} \AgdaSymbol{→} \AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaBound{a} \AgdaBound{xs}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{ε-left} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{))} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaSymbol{(}\AgdaField{ε} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaBound{xs}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(λ} \AgdaBound{a} \AgdaSymbol{→} \AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaBound{a} \AgdaBound{xs}\AgdaSymbol{)} \AgdaInductiveConstructor{refl} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaSymbol{(}\AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{x}\AgdaSymbol{)} \AgdaBound{xs}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{append-measure-lemma} \AgdaSymbol{:} \<[24]%
\>[24]\AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{xs} \AgdaSymbol{:} \AgdaDatatype{List} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{μ} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-list} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaBound{xs}\AgdaSymbol{))} \AgdaDatatype{≡}\<%
\\
\>[10]\AgdaIndent{13}{}\<[13]%
\>[13]\AgdaSymbol{(}\AgdaBound{μ} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-list} \AgdaBound{xs}\AgdaSymbol{))}\<%
\\
\>\AgdaFunction{append-measure-lemma} \AgdaBound{μ} \AgdaBound{x} \AgdaBound{xs} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{μ} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-list} \AgdaSymbol{(}\AgdaBound{x} \AgdaInductiveConstructor{∷} \AgdaBound{xs}\AgdaSymbol{))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{cong} \AgdaSymbol{(}\AgdaBound{μ} \AgdaField{∙\_}\AgdaSymbol{)} \AgdaInductiveConstructor{refl} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaBound{μ} \AgdaField{∙} \AgdaSymbol{((}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-list} \AgdaBound{xs}\AgdaSymbol{)))}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaField{∙-assoc} \AgdaBound{μ} \AgdaSymbol{(}\AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaFunction{measure-list} \AgdaBound{xs}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaSymbol{(}\AgdaBound{μ} \AgdaField{∙} \AgdaField{∥} \AgdaBound{x} \AgdaField{∥}\AgdaSymbol{)} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-list} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaFunction{toList-ft-measure-correct} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{xs} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\})}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaFunction{measure-list} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{xs}\AgdaSymbol{)} \AgdaDatatype{≡} \AgdaFunction{measure-tree} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{toList-ft-measure-correct} \AgdaBound{xs} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{measure-list} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{measure-list-lemma} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{xs}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaField{ε} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{foldl-correct} \AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{xs}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{foldl} \AgdaFunction{foldfun} \AgdaField{ε} \AgdaBound{xs}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaFunction{foldl-lemma0} \AgdaField{ε} \AgdaBound{xs} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{ε} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{≡⟨} \AgdaField{ε-left} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{xs}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaFunction{measure-tree} \AgdaBound{xs}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
%
\\
\>\AgdaComment{-- TRIVIAL CONCATENATION ---------------------------------}\<%
\\
%
\\
\>\AgdaFunction{append} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\}}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{ys} \AgdaSymbol{:} \AgdaDatatype{List} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[2]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ} \AgdaField{∙} \AgdaSymbol{(}\AgdaFunction{measure-list} \AgdaBound{ys}\AgdaSymbol{)\}}\<%
\\
\>\AgdaFunction{append} \AgdaBound{xs} \AgdaInductiveConstructor{[]} \AgdaKeyword{rewrite} \AgdaField{ε-right} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{xs}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{=} \AgdaBound{xs}\<%
\\
\>\AgdaFunction{append} \AgdaBound{xs} \AgdaSymbol{(}\AgdaBound{y} \AgdaInductiveConstructor{∷} \AgdaBound{ys}\AgdaSymbol{)} \AgdaKeyword{rewrite} \AgdaSymbol{(}\AgdaFunction{append-measure-lemma} \AgdaSymbol{(}\AgdaFunction{measure-tree} \AgdaBound{xs}\AgdaSymbol{)} \AgdaBound{y} \AgdaBound{ys}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{=} \AgdaFunction{append} \AgdaSymbol{(}\AgdaBound{y} \AgdaFunction{▷} \AgdaBound{xs}\AgdaSymbol{)} \AgdaBound{ys}\<%
\\
%
\\
\>\AgdaFunction{concat} \AgdaSymbol{:} \<[10]%
\>[10]\AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[6]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[6]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[6]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{σ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[6]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\}}\<%
\\
\>[6]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{σ}\AgdaSymbol{\}}\<%
\\
\>[6]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ} \AgdaField{∙} \AgdaBound{σ}\AgdaSymbol{\}}\<%
\\
\>\AgdaFunction{concat} \AgdaBound{xs} \AgdaBound{ys} \AgdaKeyword{rewrite} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaFunction{toList-ft-measure-correct} \AgdaBound{ys}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{6}{}\<[6]%
\>[6]\AgdaSymbol{=} \AgdaFunction{append} \AgdaBound{xs} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{ys}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaComment{-- reverse ----}\<%
\\
%
\\
\>\AgdaFunction{rev-digit} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[6]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{rv} \AgdaSymbol{:} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[6]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{Digit} \AgdaBound{A}\<%
\\
\>[6]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{Digit} \AgdaBound{A}\<%
\\
\>\AgdaFunction{rev-digit} \AgdaBound{rv} \AgdaSymbol{(}\AgdaInductiveConstructor{One} \AgdaBound{x}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{One} \AgdaSymbol{(}\AgdaBound{rv} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{rev-digit} \AgdaBound{rv} \AgdaSymbol{(}\AgdaInductiveConstructor{Two} \AgdaBound{x} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{Two} \AgdaSymbol{(}\AgdaBound{rv} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{rv} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{rev-digit} \AgdaBound{rv} \AgdaSymbol{(}\AgdaInductiveConstructor{Three} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{Three} \AgdaSymbol{(}\AgdaBound{rv} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{rv} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{rv} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{rev-digit} \AgdaBound{rv} \AgdaSymbol{(}\AgdaInductiveConstructor{Four} \AgdaBound{x} \AgdaBound{x₁} \AgdaBound{x₂} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaInductiveConstructor{Four} \AgdaSymbol{(}\AgdaBound{rv} \AgdaBound{x₃}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{rv} \AgdaBound{x₂}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{rv} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{rv} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{rev-node} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[10]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[10]\AgdaIndent{11}{}\<[11]%
\>[11]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{rv} \AgdaSymbol{:} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaDatatype{Node} \AgdaBound{A} \AgdaBound{V}\<%
\\
\>\AgdaFunction{rev-node} \AgdaBound{rv} \AgdaSymbol{(}\AgdaInductiveConstructor{Node2} \AgdaBound{v} \AgdaBound{x} \AgdaBound{y} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{node2} \AgdaSymbol{(}\AgdaBound{rv} \AgdaBound{y}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{rv} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{rev-node} \AgdaBound{rv} \AgdaSymbol{(}\AgdaInductiveConstructor{Node3} \AgdaBound{v} \AgdaBound{x} \AgdaBound{y} \AgdaBound{z} \AgdaBound{x₁}\AgdaSymbol{)} \AgdaSymbol{=} \AgdaFunction{node3} \AgdaSymbol{(}\AgdaBound{rv} \AgdaBound{z}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{rv} \AgdaBound{y}\AgdaSymbol{)} \AgdaSymbol{(}\AgdaBound{rv} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\\
\>\AgdaFunction{measure-rev-list} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{rv} \AgdaSymbol{:} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{xs} \AgdaSymbol{:} \AgdaDatatype{List} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaBound{V}\<%
\\
\>\AgdaFunction{measure-rev-list} \AgdaBound{rv} \AgdaBound{xs} \AgdaSymbol{=} \AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaField{ε} \AgdaSymbol{(}\AgdaFunction{Data.List.reverse} \AgdaSymbol{(}\AgdaFunction{Data.List.map} \AgdaBound{rv} \AgdaBound{xs}\AgdaSymbol{))}\<%
\\
%
\\
\>\AgdaFunction{measure-rev} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{\{}\AgdaBound{μ} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{rv} \AgdaSymbol{:} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{xs} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{\{}\AgdaBound{μ}\AgdaSymbol{\})}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaBound{V}\<%
\\
\>\AgdaFunction{measure-rev} \AgdaBound{rv} \AgdaBound{xs} \AgdaSymbol{=} \AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaField{ε} \AgdaSymbol{(}\AgdaFunction{Data.List.reverse} \AgdaSymbol{(}\AgdaFunction{Data.List.map} \AgdaBound{rv} \AgdaSymbol{(}\AgdaFunction{toList-ft} \AgdaBound{xs}\AgdaSymbol{)))}\<%
\\
%
\\
\>\AgdaFunction{measure-digit-rev} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}} \AgdaSymbol{\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{⦃} \AgdaBound{m} \AgdaSymbol{:} \AgdaRecord{Measured} \AgdaBound{A} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{rv} \AgdaSymbol{:} \AgdaBound{A} \AgdaSymbol{→} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{d} \AgdaSymbol{:} \AgdaDatatype{Digit} \AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{10}{}\<[10]%
\>[10]\AgdaSymbol{→} \AgdaBound{V}\<%
\\
\>\AgdaFunction{measure-digit-rev} \AgdaBound{rv} \AgdaBound{d} \AgdaSymbol{=} \AgdaFunction{Data.List.foldl} \AgdaFunction{foldfun} \AgdaField{ε} \AgdaSymbol{(}\AgdaFunction{Data.List.reverse} \AgdaSymbol{(}\AgdaFunction{Data.List.map} \AgdaBound{rv} \AgdaSymbol{(}\AgdaFunction{toList-dig} \AgdaBound{d}\AgdaSymbol{)))}\<%
\\
%
\\
\>\AgdaComment{-- foldl-dig-index : ∀ \{a\}\{A : Set a\}\{V : Set a\}\{W : V → Set a\}}\<%
\\
\>\AgdaComment{--             ⦃ mo : Monoid V ⦄}\<%
\\
\>\AgdaComment{--             ⦃ m : Measured A V ⦄}\<%
\\
\>\AgdaComment{--             → \{μ : V\}}\<%
\\
\>\AgdaComment{--             → (\{σ : V\} → W σ → (x : A) → W (∥ x ∥ ∙ σ))}\<%
\\
\>\AgdaComment{--             → W μ}\<%
\\
\>\AgdaComment{--             → (d : Digit A) → W (measure-digit d ∙ μ)}\<%
\\
\>\AgdaComment{-- foldl-dig-index f i (One x) = f i x}\<%
\\
\>\AgdaComment{-- foldl-dig-index \{μ = μ\} f i (Two x x₁)}\<%
\\
\>\AgdaComment{--   rewrite (∙-assoc (∥ x₁ ∥) (∥ x ∥) μ)}\<%
\\
\>\AgdaComment{--    = \{! f (f i x) x₁  !\}}\<%
\\
\>\AgdaComment{-- foldl-dig-index \{μ = μ\} f i (Three x x₁ x₂)}\<%
\\
\>\AgdaComment{--   rewrite assoc-lemma20 μ (∥ x ∥) (∥ x₁ ∥) (∥ x₂ ∥) = \{!   !\} -- f (f (f i x) x₁) x₂}\<%
\\
\>\AgdaComment{-- foldl-dig-index \{μ = μ\} f i  (Four x x₁ x₂ x₃)}\<%
\\
\>\AgdaComment{--   rewrite assoc-lemma30 μ (∥ x ∥) (∥ x₁ ∥) (∥ x₂ ∥) (∥ x₃ ∥) = \{!   !\} -- f (f (f (f i x) x₁) x₂) x₃}\<%
\\
\>\AgdaComment{--}\<%
\\
\>\AgdaComment{-- foldl-node-index : ∀ \{a\} \{A : Set a\}\{V : Set a\}\{W : V → Set a\}}\<%
\\
\>\AgdaComment{--                   ⦃ mo : Monoid V ⦄}\<%
\\
\>\AgdaComment{--                   ⦃ m : Measured A V ⦄}\<%
\\
\>\AgdaComment{--                   → \{μ : V\}}\<%
\\
\>\AgdaComment{--                   → (\{σ : V\} → W σ → (x : A) → W (σ ∙ ∥ x ∥))}\<%
\\
\>\AgdaComment{--                   → W μ → (n : Node A V) → W (μ ∙ measure-node n)}\<%
\\
\>\AgdaComment{-- foldl-node-index \{μ = μ\} f i (Node2 v x y x₁)}\<%
\\
\>\AgdaComment{--   rewrite x₁ | ∙-assoc μ (∥ x ∥) (∥ y ∥) = f (f i x) y}\<%
\\
\>\AgdaComment{-- foldl-node-index \{μ = μ\} f i (Node3 v x y z x₁)}\<%
\\
\>\AgdaComment{--   rewrite x₁ | assoc-lemma20 μ (∥ x ∥) (∥ y ∥) (∥ z ∥) = f (f (f i x) y) z}\<%
\\
\>\AgdaComment{-- --}\<%
\\
\>\AgdaComment{-- foldl-index : ∀ \{a\} \{A : Set a\}\{V : Set a\}\{W : V → Set a\}}\<%
\\
\>\AgdaComment{--             ⦃ mo : Monoid V ⦄}\<%
\\
\>\AgdaComment{--             ⦃ m : Measured A V ⦄}\<%
\\
\>\AgdaComment{--             → \{μ : V\} \{s : V\}}\<%
\\
\>\AgdaComment{--             → (\{σ : V\} → (W σ → (x : A) → W (σ ∙ ∥ x ∥)))}\<%
\\
\>\AgdaComment{--             → W μ → (ft : FingerTree A V \{s\}) → W (μ ∙ measure-tree ft)}\<%
\\
\>\AgdaComment{-- foldl-index \{μ = μ\} f i Empty rewrite ε-right μ = i}\<%
\\
\>\AgdaComment{-- foldl-index f i (Single e) = f i e}\<%
\\
\>\AgdaComment{-- foldl-index \{W = W\} \{μ = μ\} f i (Deep pr ft sf)}\<%
\\
\>\AgdaComment{-- --   rewrite assoc-lemma20 μ (measure-digit pr) (measure-tree ft) (measure-digit sf) = foldl-dig-index \{W = W\} f (foldl-index \{W = W\} (λ \{σ\} → foldl-node-index \{W = W\} \{μ = σ\} f) (foldl-dig-index \{W = W\} f i pr) ft) sf -- \{! foldl-dig-index f (foldl-index (λ \{σ\} → foldl-node-index \{μ = σ\} f) (foldl-dig-index f i pr) ft) sf   !\}}\<%
\\
%
\\
\>\AgdaFunction{ε-comm-lemma} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{a}\AgdaSymbol{\}\{}\AgdaBound{V} \AgdaSymbol{:} \AgdaPrimitiveType{Set} \AgdaBound{a}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{⦃} \AgdaBound{mo} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaBound{V} \AgdaSymbol{⦄}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaSymbol{:} \AgdaBound{V}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaIndent{8}{}\<[8]%
\>[8]\AgdaSymbol{→} \AgdaSymbol{(}\AgdaBound{x} \AgdaField{∙} \AgdaField{ε} \AgdaDatatype{≡} \AgdaField{ε} \AgdaField{∙} \AgdaBound{x}\AgdaSymbol{)}\<%
\\
\>\AgdaFunction{ε-comm-lemma} \AgdaBound{x} \AgdaSymbol{=}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{begin}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{x} \AgdaField{∙} \AgdaField{ε} \AgdaFunction{≡⟨} \AgdaField{ε-right} \AgdaBound{x} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaBound{x} \AgdaFunction{≡⟨} \AgdaFunction{sym} \AgdaSymbol{(}\AgdaField{ε-left} \AgdaBound{x}\AgdaSymbol{)} \AgdaFunction{⟩}\<%
\\
\>[2]\AgdaIndent{4}{}\<[4]%
\>[4]\AgdaField{ε} \AgdaField{∙} \AgdaBound{x}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{∎}\<%
\\
%
\\
\>\AgdaKeyword{module} \AgdaModule{test} \AgdaKeyword{where}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{open} \AgdaKeyword{import} \AgdaModule{numbers}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{instance} \AgdaFunction{nat} \AgdaSymbol{:} \AgdaRecord{Monoid} \AgdaDatatype{ℕ}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{nat} \AgdaSymbol{=} \AgdaInductiveConstructor{monoid} \AgdaNumber{0} \AgdaPrimitive{\_+\_} \AgdaFunction{0+} \AgdaFunction{+0} \AgdaFunction{+assoc} \AgdaFunction{\_<\_}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaKeyword{instance} \AgdaFunction{nat-measure} \AgdaSymbol{:} \AgdaSymbol{∀} \AgdaSymbol{\{}\AgdaBound{A} \AgdaSymbol{:} \AgdaPrimitiveType{Set}\AgdaSymbol{\}} \AgdaSymbol{→} \AgdaRecord{Measured} \AgdaBound{A} \AgdaDatatype{ℕ}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{nat-measure} \AgdaSymbol{=} \AgdaInductiveConstructor{measured} \AgdaSymbol{(λ} \AgdaBound{x} \AgdaSymbol{→} \AgdaNumber{1}\AgdaSymbol{)}\<%
\\
%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{ex-ft1} \AgdaSymbol{:} \AgdaDatatype{FingerTree} \AgdaDatatype{ℕ} \AgdaDatatype{ℕ}\<%
\\
\>[0]\AgdaIndent{2}{}\<[2]%
\>[2]\AgdaFunction{ex-ft1} \AgdaSymbol{=} \AgdaNumber{0} \AgdaFunction{◁} \AgdaNumber{1} \AgdaFunction{◁} \AgdaNumber{2} \AgdaFunction{◁} \AgdaNumber{3} \AgdaFunction{◁} \AgdaNumber{4} \AgdaFunction{◁} \AgdaNumber{5} \AgdaFunction{◁} \AgdaNumber{6} \AgdaFunction{◁} \AgdaNumber{7} \AgdaFunction{◁} \AgdaNumber{8} \AgdaFunction{◁} \AgdaInductiveConstructor{Empty}\<%
\end{code}
